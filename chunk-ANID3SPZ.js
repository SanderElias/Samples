import{a as Ze,d as qe,e as Be}from"./chunk-IHPZU2R7.js";import{Ba as _,Ea as je,Fc as Ke,Gc as N,Hc as o,Ic as H,Jc as ne,Pc as $e,Yc as Ue,Zc as Ge,a as b,cb as _e,ea as m,ia as re,lb as V,na as j,oa as Oe,pa as Fe,ra as xe,sb as Ve,va as k,xc as He}from"./chunk-LWK3ZSJS.js";import{a as ee,b as te}from"./chunk-DAQOROHW.js";function S(r){return Array.isArray(r)}function p(r){return(typeof r=="object"||typeof r=="function")&&r!=null}function R(r,e,t,n){let i=r.structure.childrenMap();if(!i)return e;let s=e;for(let a of i.values()){if(n?.(s))break;s=t(a,s)}return s}function ct(r){return!r}function We(r){return r}function ft(r){return r.errors().length>0?"invalid":r.pending()?"unknown":"valid"}var se=class{node;constructor(e){this.node=e}rawSyncTreeErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncTreeErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawSyncTreeErrors()??[]]);syncErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncErrors.compute(this.node.context),...this.syncTreeErrors(),...gt(this.node.submitState.serverErrors())]);syncValid=o(()=>this.shouldSkipValidation()?!0:R(this.node,this.syncErrors().length===0,(e,t)=>t&&e.validationState.syncValid(),ct));syncTreeErrors=o(()=>this.rawSyncTreeErrors().filter(e=>e.field===this.node.fieldProxy));rawAsyncErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.asyncErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawAsyncErrors()??[]]);asyncErrors=o(()=>this.shouldSkipValidation()?[]:this.rawAsyncErrors().filter(e=>e==="pending"||e.field===this.node.fieldProxy));errors=o(()=>[...this.syncErrors(),...this.asyncErrors().filter(e=>e!=="pending")]);errorSummary=o(()=>R(this.node,this.errors(),(e,t)=>[...t,...e.errorSummary()]));pending=o(()=>R(this.node,this.asyncErrors().includes("pending"),(e,t)=>t||e.validationState.asyncErrors().includes("pending")));status=o(()=>{if(this.shouldSkipValidation())return"valid";let e=ft(this);return R(this.node,e,(t,n)=>n==="invalid"||t.validationState.status()==="invalid"?"invalid":n==="unknown"||t.validationState.status()==="unknown"?"unknown":"valid",t=>t==="invalid")});valid=o(()=>this.status()==="valid");invalid=o(()=>this.status()==="invalid");shouldSkipValidation=o(()=>this.node.hidden()||this.node.disabled()||this.node.readonly())};function gt(r){return r===void 0?[]:S(r)?r:[r]}function yt(r,e){if(S(r))for(let t of r)t.field??=e;else r&&(r.field??=e);return r}var oe=Symbol(),X=Symbol(),L=class{predicates;fns=[];constructor(e){this.predicates=e}push(e){this.fns.push(Xe(this.predicates,e))}mergeIn(e){let t=this.predicates?e.fns.map(n=>Xe(this.predicates,n)):e.fns;this.fns.push(...t)}},$=class extends L{get defaultValue(){return!1}compute(e){return this.fns.some(t=>{let n=t(e);return n&&n!==X})}},D=class r extends L{ignore;static ignoreNull(e){return new r(e,t=>t===null)}constructor(e,t){super(e),this.ignore=t}get defaultValue(){return[]}compute(e){return this.fns.reduce((t,n)=>{let i=n(e);return i===void 0||i===X?t:S(i)?[...t,...this.ignore?i.filter(s=>!this.ignore(s)):i]:this.ignore&&this.ignore(i)?t:[...t,i]},[])}},ae=class extends D{constructor(e){super(e,void 0)}},de=class extends L{key;get defaultValue(){return this.key.getInitial()}constructor(e,t){super(e),this.key=t}compute(e){if(this.fns.length===0)return this.key.getInitial();let t=this.key.getInitial();for(let n=0;n<this.fns.length;n++){let i=this.fns[n](e);i!==X&&(t=this.key.reduce(t,i))}return t}};function Xe(r,e){return r.length===0?e:t=>{for(let n of r){let i=t.stateOf(n.path),s=N(i.structure.pathKeys).length-n.depth;for(let a=0;a<s;a++)i=i.structure.parent;if(!n.fn(i.context))return X}return e(t)}}var I=class{predicates;hidden;disabledReasons;readonly;syncErrors;syncTreeErrors;asyncErrors;aggregateProperties=new Map;propertyFactories=new Map;constructor(e){this.predicates=e,this.hidden=new $(e),this.disabledReasons=new ae(e),this.readonly=new $(e),this.syncErrors=D.ignoreNull(e),this.syncTreeErrors=D.ignoreNull(e),this.asyncErrors=D.ignoreNull(e)}hasAggregateProperty(e){return this.aggregateProperties.has(e)}getAggregatePropertyEntries(){return this.aggregateProperties.entries()}getPropertyFactoryEntries(){return this.propertyFactories.entries()}getAggregateProperty(e){return this.aggregateProperties.has(e)||this.aggregateProperties.set(e,new de(this.predicates,e)),this.aggregateProperties.get(e)}addPropertyFactory(e,t){if(this.propertyFactories.has(e))throw new Error("Can't define value twice for the same Property");this.propertyFactories.set(e,t)}mergeIn(e){this.hidden.mergeIn(e.hidden),this.disabledReasons.mergeIn(e.disabledReasons),this.readonly.mergeIn(e.readonly),this.syncErrors.mergeIn(e.syncErrors),this.syncTreeErrors.mergeIn(e.syncTreeErrors),this.asyncErrors.mergeIn(e.asyncErrors);for(let[t,n]of e.getAggregatePropertyEntries())this.getAggregateProperty(t).mergeIn(n);for(let[t,n]of e.getPropertyFactoryEntries())this.addPropertyFactory(t,n)}},ue=0;function mt(){return ue}function v(r,e){return(...t)=>{try{return ue=e,r(...t)}finally{ue=0}}}var U=class{depth;constructor(e){this.depth=e}build(){return new G(this,[],0)}},C=class r extends U{constructor(e){super(e)}current;all=[];addHiddenRule(e){this.getCurrent().addHiddenRule(e)}addDisabledReasonRule(e){this.getCurrent().addDisabledReasonRule(e)}addReadonlyRule(e){this.getCurrent().addReadonlyRule(e)}addSyncErrorRule(e){this.getCurrent().addSyncErrorRule(e)}addSyncTreeErrorRule(e){this.getCurrent().addSyncTreeErrorRule(e)}addAsyncErrorRule(e){this.getCurrent().addAsyncErrorRule(e)}addAggregatePropertyRule(e,t){this.getCurrent().addAggregatePropertyRule(e,t)}addPropertyFactory(e,t){this.getCurrent().addPropertyFactory(e,t)}getChild(e){return this.getCurrent().getChild(e)}hasLogic(e){return this===e?!0:this.all.some(({builder:t})=>t.hasLogic(e))}mergeIn(e,t){t?this.all.push({builder:e,predicate:{fn:v(t.fn,this.depth),path:t.path}}):this.all.push({builder:e}),this.current=void 0}getCurrent(){return this.current===void 0&&(this.current=new O(this.depth),this.all.push({builder:this.current})),this.current}static newRoot(){return new r(0)}},O=class extends U{logic=new I([]);children=new Map;constructor(e){super(e)}addHiddenRule(e){this.logic.hidden.push(v(e,this.depth))}addDisabledReasonRule(e){this.logic.disabledReasons.push(v(e,this.depth))}addReadonlyRule(e){this.logic.readonly.push(v(e,this.depth))}addSyncErrorRule(e){this.logic.syncErrors.push(v(e,this.depth))}addSyncTreeErrorRule(e){this.logic.syncTreeErrors.push(v(e,this.depth))}addAsyncErrorRule(e){this.logic.asyncErrors.push(v(e,this.depth))}addAggregatePropertyRule(e,t){this.logic.getAggregateProperty(e).push(v(t,this.depth))}addPropertyFactory(e,t){this.logic.addPropertyFactory(e,v(t,this.depth))}getChild(e){return this.children.has(e)||this.children.set(e,new C(this.depth+1)),this.children.get(e)}hasLogic(e){return this===e}},G=class r{builder;predicates;depth;logic;constructor(e,t,n){this.builder=e,this.predicates=t,this.depth=n,this.logic=e?pt(e,t,n):new I([])}getChild(e){let t=this.builder?et(this.builder,e):[];if(t.length===0)return new r(void 0,[],this.depth+1);if(t.length===1){let{builder:n,predicates:i}=t[0];return new r(n,[...this.predicates,...i.map(s=>he(s,this.depth))],this.depth+1)}else{let n=t.map(({builder:i,predicates:s})=>new r(i,[...this.predicates,...s.map(a=>he(a,this.depth))],this.depth+1));return new le(n)}}hasLogic(e){return this.builder?.hasLogic(e)??!1}},le=class r{all;logic;constructor(e){this.all=e,this.logic=new I([]);for(let t of e)this.logic.mergeIn(t.logic)}getChild(e){return new r(this.all.flatMap(t=>t.getChild(e)))}hasLogic(e){return this.all.some(t=>t.hasLogic(e))}};function et(r,e){if(r instanceof C)return r.all.flatMap(({builder:t,predicate:n})=>{let i=et(t,e);return n?i.map(({builder:s,predicates:a})=>({builder:s,predicates:[...a,n]})):i});if(r instanceof O){if(r.children.has(e))return[{builder:r.children.get(e),predicates:[]}]}else throw new Error("Unknown LogicNodeBuilder type");return[]}function pt(r,e,t){let n=new I(e);if(r instanceof C){let i=r.all.map(({builder:s,predicate:a})=>new G(s,a?[...e,he(a,t)]:e,t));for(let s of i)n.mergeIn(s.logic)}else if(r instanceof O)n.mergeIn(r.logic);else throw new Error("Unknown LogicNodeBuilder type");return n}function he(r,e){return te(ee({},r),{depth:e})}var tt=Symbol("PATH"),f=class r{keys;logic;root;children=new Map;fieldPathProxy=new Proxy(this,bt);constructor(e,t,n){this.keys=e,this.logic=t,this.root=n??this}get element(){return this.getChild(oe)}getChild(e){return this.children.has(e)||this.children.set(e,new r([...this.keys,e],this.logic.getChild(e),this.root)),this.children.get(e)}mergeIn(e,t){let n=e.compile();this.logic.mergeIn(n.logic,t)}static unwrapFieldPath(e){return e[tt]}static newRoot(){return new r([],C.newRoot(),void 0)}},bt={get(r,e){return e===tt?r:r.getChild(e).fieldPathProxy}},K,z=new Map,M=class r{schemaFn;constructor(e){this.schemaFn=e}compile(){if(z.has(this))return z.get(this);let e=f.newRoot();z.set(this,e);let t=K;try{K=e,this.schemaFn(e.fieldPathProxy)}finally{K=t}return e}static create(e){return e instanceof r?e:new r(e)}static rootCompile(e){try{return z.clear(),e===void 0?f.newRoot():e instanceof r?e.compile():new r(e).compile()}finally{z.clear()}}};function vt(r){return r instanceof M||typeof r=="function"}function P(r){if(K!==f.unwrapFieldPath(r).root)throw new Error("A FieldPath can only be used directly within the Schema that owns it, **not** outside of it or within a sub-schema.")}var Z=class{brand;constructor(){}};function St(){return new Z}var q=class{reduce;getInitial;brand;constructor(e,t){this.reduce=e,this.getInitial=t}};function Y(r,e){return new q(r,e)}function wt(){return Y((r,e)=>e===void 0?r:[...r,e],()=>[])}function rt(){return Y((r,e)=>r===void 0?e:e===void 0?r:Math.min(r,e),()=>{})}function nt(){return Y((r,e)=>r===void 0?e:e===void 0?r:Math.max(r,e),()=>{})}function Et(){return Y((r,e)=>r||e,()=>!1)}var B=Et(),Ye=nt(),Qe=rt(),ce=nt(),fe=rt(),Nt=wt();function Wt(r,e){P(r),f.unwrapFieldPath(r).logic.addDisabledReasonRule(n=>{let i=!0;return typeof e=="string"?i=e:e&&(i=e(n)),typeof i=="string"?{field:n.field,message:i}:i?{field:n.field}:void 0})}function Xt(r,e=()=>!0){P(r),f.unwrapFieldPath(r).logic.addReadonlyRule(e)}function Ie(r,e){P(r),f.unwrapFieldPath(r).logic.addSyncErrorRule(n=>yt(e(n),n.field))}function Ce(r,e,t){P(r),f.unwrapFieldPath(r).logic.addAggregatePropertyRule(e,t)}function Te(r,...e){P(r);let t,n;return e.length===2?[t,n]=e:[n]=e,t??=St(),f.unwrapFieldPath(r).logic.addPropertyFactory(t,n),t}var ge=class{field;constructor(e){this.field=e}control=this;get value(){return this.field().value()}get valid(){return this.field().valid()}get invalid(){return this.field().invalid()}get pending(){return this.field().pending()}get disabled(){return this.field().disabled()}get enabled(){return!this.field().disabled()}get errors(){let e=this.field().errors();if(e.length===0)return null;let t={};for(let n of e)t[n.kind]=n;return t}get pristine(){return!this.field().dirty()}get dirty(){return this.field().dirty()}get touched(){return this.field().touched()}get untouched(){return!this.field().touched()}get status(){if(this.field().disabled())return"DISABLED";if(this.field().valid())return"VALID";if(this.field().invalid())return"INVALID";if(this.field().pending())return"PENDING";throw Error("AssertionError: unknown form control status")}valueAccessor=null;hasValidator(e){return e===qe.required?this.field().property(B)():!1}updateValueAndValidity(){}};function At(r){if(kt(r),!(r._tNode.directiveStart===0||r._tNode.componentOffset===-1))return r._lView[r._tNode.directiveStart+r._tNode.componentOffset]}function Pt(r,e){r[b].applyValueToInputSignal(r[b],e)}function g(r){return it(r)}function F(r){return it(r)&&p(r)&&"subscribe"in r}function Mt(r){r[b].run()}function kt(r){if(!("_tNode"in r))throw new Error("Expected a Node Injector")}function it(r){if(!p(r)||!(b in r))return!1;let e=r[b];return p(e)&&"applyValueToInputSignal"in e}var st=(()=>{class r{injector=m(j);renderer=m(_e);initialized=!1;field=k(void 0);set _field(t){this.field.set(t),this.initialized||this.initialize()}state=o(()=>this.field()());el=m(_);cvaArray=m(Ze,{optional:!0});_ngControl;get ngControl(){return this._ngControl??=new ge(()=>this.state())}get cva(){return this.cvaArray?.[0]??this._ngControl?.valueAccessor??void 0}initialize(){this.initialized=!0;let t=this.injector,n=At(t);if(!(n&&Dt(n))){if(n&&Rt(n))this.setupCustomUiControl(n);else if(this.cva!==void 0)this.setupControlValueAccessor(this.cva);else if(this.el.nativeElement instanceof HTMLInputElement||this.el.nativeElement instanceof HTMLTextAreaElement||this.el.nativeElement instanceof HTMLSelectElement)this.setupNativeInput(this.el.nativeElement);else throw new Error("Unhandled control?");H(i=>{let s=this.state();s.nodeState.controls.update(a=>[...a,this]),i(()=>{s.nodeState.controls.update(a=>a.filter(h=>h!==this))})},{injector:this.injector})}}setupNativeInput(t){let n=t instanceof HTMLTextAreaElement?"text":t instanceof HTMLSelectElement?"select":t.type;switch(t.addEventListener("input",()=>{switch(n){case"checkbox":this.state().value.set(t.checked);break;case"radio":this.state().value.set(t.value);break;case"number":case"range":case"datetime-local":typeof this.state().value()=="number"?this.state().value.set(t.valueAsNumber):this.state().value.set(t.value);break;case"date":case"month":case"week":case"time":Je(this.state().value())?this.state().value.set(t.valueAsDate):typeof this.state().value()=="number"?this.state().value.set(t.valueAsNumber):this.state().value.set(t.value);break;default:this.state().value.set(t.value);break}this.state().markAsDirty()}),t.addEventListener("blur",()=>this.state().markAsTouched()),this.maybeSynchronize(()=>this.state().readonly(),this.withBooleanAttribute(t,"readonly")),this.maybeSynchronize(()=>this.state().disabled(),this.withBooleanAttribute(t,"disabled")),this.maybeSynchronize(()=>this.state().name(),this.withAttribute(t,"name")),this.maybeSynchronize(this.propertySource(B),this.withBooleanAttribute(t,"required")),this.maybeSynchronize(this.propertySource(Ye),this.withAttribute(t,"min")),this.maybeSynchronize(this.propertySource(ce),this.withAttribute(t,"minLength")),this.maybeSynchronize(this.propertySource(Qe),this.withAttribute(t,"max")),this.maybeSynchronize(this.propertySource(fe),this.withAttribute(t,"maxLength")),n){case"checkbox":this.maybeSynchronize(()=>this.state().value(),i=>t.checked=i);break;case"radio":this.maybeSynchronize(()=>this.state().value(),i=>{t.checked=t.value===i});break;case"select":this.maybeSynchronize(()=>this.state().value(),i=>{Ve(()=>t.value=i,{injector:this.injector})});break;case"number":case"range":case"datetime-local":this.maybeSynchronize(()=>this.state().value(),i=>{typeof i=="number"?t.valueAsNumber=i:t.value=i});break;case"date":case"month":case"week":case"time":this.maybeSynchronize(()=>this.state().value(),i=>{Je(i)?t.valueAsDate=i:typeof i=="number"?t.valueAsNumber=i:t.value=i});break;default:this.maybeSynchronize(()=>this.state().value(),i=>{t.value=i});break}}setupControlValueAccessor(t){t.registerOnChange(n=>this.state().value.set(n)),t.registerOnTouched(()=>this.state().markAsTouched()),this.maybeSynchronize(()=>this.state().value(),n=>t.writeValue(n)),t.setDisabledState&&this.maybeSynchronize(()=>this.state().disabled(),n=>t.setDisabledState(n)),t.writeValue(this.state().value()),t.setDisabledState?.(this.state().disabled())}setupCustomUiControl(t){let n;if(ot(t))this.maybeSynchronize(()=>this.state().value(),l(t.value)),n=t.value.subscribe(a=>this.state().value.set(a));else if(at(t))this.maybeSynchronize(()=>this.state().value(),l(t.checked)),n=t.checked.subscribe(a=>this.state().value.set(a));else throw new Error("Unknown custom control subtype");this.maybeSynchronize(()=>this.state().name(),l(t.name)),this.maybeSynchronize(()=>this.state().disabled(),l(t.disabled)),this.maybeSynchronize(()=>this.state().disabledReasons(),l(t.disabledReasons)),this.maybeSynchronize(()=>this.state().readonly(),l(t.readonly)),this.maybeSynchronize(()=>this.state().hidden(),l(t.hidden)),this.maybeSynchronize(()=>this.state().errors(),l(t.errors)),(F(t.touched)||g(t.touched))&&this.maybeSynchronize(()=>this.state().touched(),l(t.touched)),this.maybeSynchronize(()=>this.state().dirty(),l(t.dirty)),this.maybeSynchronize(()=>this.state().invalid(),l(t.invalid)),this.maybeSynchronize(()=>this.state().pending(),l(t.pending)),this.maybeSynchronize(this.propertySource(B),l(t.required)),this.maybeSynchronize(this.propertySource(Ye),l(t.min)),this.maybeSynchronize(this.propertySource(ce),l(t.minLength)),this.maybeSynchronize(this.propertySource(Qe),l(t.max)),this.maybeSynchronize(this.propertySource(fe),l(t.maxLength)),this.maybeSynchronize(this.propertySource(Nt),l(t.pattern));let i,s;if(F(t.touched)||dt(t.touched))i=t.touched.subscribe(()=>this.state().markAsTouched());else{let a=h=>{let w=h.relatedTarget;this.el.nativeElement.contains(w)||this.state().markAsTouched()};this.el.nativeElement.addEventListener("focusout",a),s=()=>this.el.nativeElement.removeEventListener("focusout",a)}this.injector.get(Fe).onDestroy(()=>{n?.unsubscribe(),i?.unsubscribe(),s?.()})}maybeSynchronize(t,n){if(!n)return;let i=H(()=>{let s=t();N(()=>n(s))},{injector:this.injector});Mt(i)}propertySource(t){let n=o(()=>this.state().hasProperty(t)?this.state().property(t):t.getInitial);return()=>n()?.()}withAttribute(t,n){return i=>{i!==void 0?this.renderer.setAttribute(t,n,i.toString()):this.renderer.removeAttribute(t,n)}}withBooleanAttribute(t,n){return i=>{i?this.renderer.setAttribute(t,n,""):this.renderer.removeAttribute(t,n)}}static \u0275fac=function(n){return new(n||r)};static \u0275dir=V({type:r,selectors:[["","control",""]],inputs:{_field:[0,"control","_field"]},features:[He([{provide:Be,useFactory:()=>m(r).ngControl}])]})}return r})();function l(r){return r?e=>Pt(r,e):void 0}function Rt(r){let e=r;return(ot(e)||at(e))&&(e.readonly===void 0||g(e.readonly))&&(e.disabled===void 0||g(e.disabled))&&(e.disabledReasons===void 0||g(e.disabledReasons))&&(e.errors===void 0||g(e.errors))&&(e.invalid===void 0||g(e.invalid))&&(e.pending===void 0||g(e.pending))&&(e.touched===void 0||F(e.touched)||g(e.touched)||dt(e.touched))&&(e.dirty===void 0||g(e.dirty))&&(e.min===void 0||g(e.min))&&(e.minLength===void 0||g(e.minLength))&&(e.max===void 0||g(e.max))&&(e.maxLength===void 0||g(e.maxLength))}function ot(r){return F(r.value)}function at(r){return F(r.checked)&&r.value===void 0}function Dt(r){return Ge(r.constructor)?.inputs.some(t=>t.templateName==="control")??!1}function dt(r){return r instanceof Ke||r instanceof xe}function Je(r){return r===null||r instanceof Date}var ye=class{node;cache=new WeakMap;constructor(e){this.node=e}resolve(e){if(!this.cache.has(e)){let t=o(()=>{let n=f.unwrapFieldPath(e),i=this.node,s=mt();for(;s>0||!i.structure.logic.hasLogic(n.root.logic);)if(s--,i=i.structure.parent,i===void 0)throw new Error("Path is not part of this field tree.");for(let a of n.keys)if(i=i.structure.getChild(a),i===void 0)throw new Error(`Cannot resolve path .${n.keys.join(".")} relative to field ${["<root>",...this.node.structure.pathKeys()].join(".")}.`);return i.fieldProxy});this.cache.set(e,t)}return this.cache.get(e)()}get field(){return this.node.fieldProxy}get state(){return this.node}get value(){return this.node.structure.value}get key(){return this.node.structure.keyInParent}index=o(()=>{let e=this.key();if(!S(N(this.node.structure.parent.value)))throw new Error("RuntimeError: cannot access index, parent field is not an array");return Number(e)});fieldOf=e=>this.resolve(e);stateOf=e=>this.resolve(e)();valueOf=e=>this.resolve(e)().value()},me=class{node;properties=new Map;constructor(e){this.node=e,N(()=>re(this.node.structure.injector,()=>{for(let[t,n]of this.node.logicNode.logic.getPropertyFactoryEntries())this.properties.set(t,n(this.node.context))}))}get(e){if(e instanceof Z)return this.properties.get(e);if(!this.properties.has(e)){let t=this.node.logicNode.logic.getAggregateProperty(e),n=o(()=>t.compute(this.node.context));this.properties.set(e,n)}return this.properties.get(e)}has(e){return e instanceof q?this.node.logicNode.logic.hasAggregateProperty(e):this.properties.has(e)}},It={get(r,e){let t=r(),n=t.structure.getChild(e);if(n!==void 0)return n.fieldProxy;let i=N(t.value);if(S(i)){if(e==="length")return t.value().length;if(e===Symbol.iterator)return Array.prototype[e]}}};function Ct(r,e){let t=o(()=>r()[e()]);return t[b]=r[b],t.set=n=>{r.update(i=>Tt(i,n,e()))},t.update=n=>{t.set(n(N(t)))},t.asReadonly=()=>t,t}function Tt(r,e,t){if(S(r)){let n=[...r];return n[t]=e,n}else return te(ee({},r),{[t]:e})}var W=class{logic;identitySymbol=Symbol();_injector=void 0;get injector(){return this._injector??=j.create({providers:[],parent:this.fieldManager.injector}),this._injector}constructor(e){this.logic=e}children(){return this.childrenMap()?.values()??[]}getChild(e){let t=this.childrenMap(),n=this.value();if(!(!t||!p(n))){if(S(n)){let i=n[e];p(i)&&i.hasOwnProperty(this.identitySymbol)&&(e=i[this.identitySymbol])}return t.get(typeof e=="number"?e.toString():e)}}destroy(){this.injector.destroy()}},pe=class extends W{node;fieldManager;value;get parent(){}get root(){return this.node}get pathKeys(){return zt}get keyInParent(){return Lt}childrenMap;constructor(e,t,n,i,s,a,h){super(n),this.node=e,this.fieldManager=i,this.value=s,this.childrenMap=ut(e,s,this.identitySymbol,t,n,a,h)}},be=class extends W{parent;root;pathKeys;keyInParent;value;childrenMap;get fieldManager(){return this.root.structure.fieldManager}constructor(e,t,n,i,s,a,h,w){if(super(n),this.parent=i,this.root=this.parent.structure.root,this.pathKeys=o(()=>[...i.structure.pathKeys(),this.keyInParent()]),s===void 0){let d=a;this.keyInParent=o(()=>{if(i.structure.childrenMap()?.get(d)!==e)throw new Error(`RuntimeError: orphan field, looking for property '${d}' of ${ie(i)}`);return d})}else{let d=a;this.keyInParent=o(()=>{let E=i.structure.value();if(!S(E))throw new Error(`RuntimeError: orphan field, expected ${ie(i)} to be an array`);let c=E[d];if(p(c)&&c.hasOwnProperty(i.structure.identitySymbol)&&c[i.structure.identitySymbol]===s)return d;for(let u=0;u<E.length;u++){let y=E[u];if(p(y)&&y.hasOwnProperty(i.structure.identitySymbol)&&y[i.structure.identitySymbol]===s)return d=u.toString()}throw new Error(`RuntimeError: orphan field, can't find element in array ${ie(i)}`)})}this.value=Ct(this.parent.structure.value,this.keyInParent),this.childrenMap=ut(e,this.value,this.identitySymbol,t,n,h,w),this.fieldManager.structures.add(this)}};var zt=o(()=>[]),Lt=o(()=>{throw new Error("RuntimeError: the top-level field in the form has no parent")});function ut(r,e,t,n,i,s,a){return ne({source:e,computation:(h,w)=>{let d=w?.value;if(!p(h))return;let E=S(h);if(d!==void 0){let c;if(E){c=new Set(d.keys());for(let u=0;u<h.length;u++){let y=h[u];p(y)&&y.hasOwnProperty(t)?c.delete(y[t]):c.delete(u.toString())}for(let u of c)d.delete(u)}else for(let u of d.keys())h.hasOwnProperty(u)||d.delete(u)}for(let c of Object.keys(h)){let u,y=h[c];if(y===void 0){d?.delete(c);continue}E&&p(y)&&(u=y[t]??=Symbol(""));let Le=u??c;if(d?.has(Le))continue;let Q,J;E?(Q=n.getChild(oe),J=i.getChild(oe)):(Q=n.getChild(c),J=i.getChild(c)),d??=new Map,d.set(Le,a({kind:"child",parent:r,pathNode:Q,logic:J,initialKeyInParent:c,identityInParent:u,fieldAdapter:s}))}return d},equal:()=>!1})}function ie(r){return`<root>.${r.structure.pathKeys().join(".")}`}var ve=class{node;selfSubmitting=k(!1);serverErrors;constructor(e){this.node=e,this.serverErrors=ne({source:this.node.structure.value,computation:()=>[]})}submitting=o(()=>this.selfSubmitting()||(this.node.structure.parent?.submitting()??!1))},x=class r{structure;validationState;propertyState;nodeState;submitState;_context=void 0;fieldAdapter;get context(){return this._context??=new ye(this)}fieldProxy=new Proxy(()=>this,It);constructor(e){this.fieldAdapter=e.fieldAdapter,this.structure=this.fieldAdapter.createStructure(this,e),this.validationState=this.fieldAdapter.createValidationState(this,e),this.nodeState=this.fieldAdapter.createNodeState(this,e),this.propertyState=new me(this),this.submitState=new ve(this)}get logicNode(){return this.structure.logic}get value(){return this.structure.value}get keyInParent(){return this.structure.keyInParent}get errors(){return this.validationState.errors}get errorSummary(){return this.validationState.errorSummary}get pending(){return this.validationState.pending}get valid(){return this.validationState.valid}get invalid(){return this.validationState.invalid}get dirty(){return this.nodeState.dirty}get touched(){return this.nodeState.touched}get disabled(){return this.nodeState.disabled}get disabledReasons(){return this.nodeState.disabledReasons}get hidden(){return this.nodeState.hidden}get readonly(){return this.nodeState.readonly}get controls(){return this.nodeState.controls}get submitting(){return this.submitState.submitting}get name(){return this.nodeState.name}property(e){return this.propertyState.get(e)}hasProperty(e){return this.propertyState.has(e)}markAsTouched(){this.nodeState.markAsTouched()}markAsDirty(){this.nodeState.markAsDirty()}reset(){this.nodeState.markAsUntouched(),this.nodeState.markAsPristine();for(let e of this.structure.children())e.reset()}static newRoot(e,t,n,i){return i.newRoot(e,t,n,i)}static newChild(e){return e.fieldAdapter.newChild(e)}createStructure(e){return e.kind==="root"?new pe(this,e.pathNode,e.logic,e.fieldManager,e.value,e.fieldAdapter,r.newChild):new be(this,e.pathNode,e.logic,e.parent,e.identityInParent,e.initialKeyInParent,e.fieldAdapter,r.newChild)}},Se=class{node;selfTouched=k(!1);selfDirty=k(!1);markAsTouched(){this.selfTouched.set(!0)}markAsDirty(){this.selfDirty.set(!0)}markAsPristine(){this.selfDirty.set(!1)}markAsUntouched(){this.selfTouched.set(!1)}controls=k([]);constructor(e){this.node=e}dirty=o(()=>{let e=this.selfDirty()&&!this.isNonInteractive();return R(this.node,e,(t,n)=>n||t.nodeState.dirty(),We)});touched=o(()=>{let e=this.selfTouched()&&!this.isNonInteractive();return R(this.node,e,(t,n)=>n||t.nodeState.touched(),We)});disabledReasons=o(()=>[...this.node.structure.parent?.nodeState.disabledReasons()??[],...this.node.logicNode.logic.disabledReasons.compute(this.node.context)]);disabled=o(()=>!!this.disabledReasons().length);readonly=o(()=>(this.node.structure.parent?.nodeState.readonly()||this.node.logicNode.logic.readonly.compute(this.node.context))??!1);hidden=o(()=>(this.node.structure.parent?.nodeState.hidden()||this.node.logicNode.logic.hidden.compute(this.node.context))??!1);name=o(()=>{let e=this.node.structure.parent;return e?`${e.name()}.${this.node.structure.keyInParent()}`:this.node.structure.fieldManager.rootName});isNonInteractive=o(()=>this.hidden()||this.disabled()||this.readonly())},we=class{newRoot(e,t,n,i){return new x({kind:"root",fieldManager:e,value:t,pathNode:n,logic:n.logic.build(),fieldAdapter:i})}newChild(e){return new x(e)}createNodeState(e){return new Se(e)}createValidationState(e){return new se(e)}createStructure(e,t){return e.createStructure(t)}},Ee=class{injector;rootName;constructor(e,t){this.injector=e,this.rootName=t??`${this.injector.get(je)}.form${Ot++}`}structures=new Set;createFieldManagementEffect(e){H(()=>{let t=new Set;this.markStructuresLive(e,t);for(let n of this.structures)t.has(n)||(this.structures.delete(n),N(()=>n.destroy()))},{injector:this.injector})}markStructuresLive(e,t){t.add(e);for(let n of e.children())this.markStructuresLive(n.structure,t)}},Ot=0;function Ft(r){let e,t,n;return r.length===3?[e,t,n]=r:r.length===2?vt(r[1])?[e,t]=r:[e,n]=r:[e]=r,[e,t,n]}function Yt(...r){let[e,t,n]=Ft(r),i=n?.injector??m(j),s=re(i,()=>M.rootCompile(t)),a=new Ee(i,n?.name),h=n?.adapter??new we,w=x.newRoot(a,e,s,h);return a.createFieldManagementEffect(w.structure),w.fieldProxy}function Qt(r,e){P(r);let t=f.unwrapFieldPath(r).element.fieldPathProxy;xt(t,e)}function xt(r,e){P(r),f.unwrapFieldPath(r).mergeIn(M.create(e))}function jt(r,e,t){P(r),f.unwrapFieldPath(r).mergeIn(M.create(t),{fn:e,path:r})}function Jt(r,e,t){jt(r,({value:n})=>e(n()),t)}function er(r){return M.create(r)}function _t(r){return new Ae(r)}function tr(r,e){return new Pe(r,e)}function rr(r,e){return new Me(r,e)}function Vt(r,e){return new ke(r,e)}function Ht(r,e){return new Re(r,e)}function nr(r,e){return new De(r,e)}function ir(r){return new Ne(r)}var Ne=class{__brand=void 0;kind="";field;message;constructor(e){e&&Object.assign(this,e)}},A=class{__brand=void 0;kind="";field;message;constructor(e){e&&Object.assign(this,e)}},Ae=class extends A{kind="required"},Pe=class extends A{min;kind="min";constructor(e,t){super(t),this.min=e}},Me=class extends A{max;kind="max";constructor(e,t){super(t),this.max=e}},ke=class extends A{minLength;kind="minLength";constructor(e,t){super(t),this.minLength=e}},Re=class extends A{maxLength;kind="maxLength";constructor(e,t){super(t),this.maxLength=e}},De=class extends A{pattern;kind="pattern";constructor(e,t){super(t),this.pattern=e}};function lt(r){let e=r;return typeof e.length=="number"?e.length:e.size}function T(r,e){return r instanceof Function?r(e):r}function ze(r){return typeof r=="number"?isNaN(r):r===""||r===!1||r==null}function sr(r,e,t){let n=Te(r,i=>o(()=>typeof e=="number"?e:e(i)));Ce(r,fe,({state:i})=>i.property(n)()),Ie(r,i=>{if(ze(i.value()))return;let s=i.state.property(n)();if(s!==void 0&&lt(i.value())>s)return t?.error?T(t.error,i):Ht(s,{message:T(t?.message,i)})})}function or(r,e,t){let n=Te(r,i=>o(()=>typeof e=="number"?e:e(i)));Ce(r,ce,({state:i})=>i.property(n)()),Ie(r,i=>{if(ze(i.value()))return;let s=i.state.property(n)();if(s!==void 0&&lt(i.value())<s)return t?.error?T(t.error,i):Vt(s,{message:T(t?.message,i)})})}function ar(r,e){let t=Te(r,n=>o(()=>e?.when?e.when(n):!0));Ce(r,B,({state:n})=>n.property(t)()),Ie(r,n=>{if(n.state.property(t)()&&ze(n.value()))return e?.error?T(e.error,n):_t({message:T(e?.message,n)})})}var fr=(()=>{class r{#i;#r;#t;#n;#e;#s;constructor(){this.showError=$e(""),this.#i=m(st),this.#r=m(Oe),this.#t=m(_).nativeElement,this.#n=this.#t.parentElement,this.#e=this.#r.createElement("div"),this.#s=o(()=>{let t=this.#i.state().errors();return!t||t.length===0?[]:t.map(n=>n?.message??JSON.stringify(n))}),this.#e.classList.add("error-messages"),Ue(()=>{let t=this.#s(),n=this.findNgContentAttributes();n&&this.#e.setAttribute(n,""),t.length>0?(this.renderErrors(t),this.attachErrorContainer(),this.#t.setCustomValidity(t.join(", "))):(this.#t.setCustomValidity(""),this.#e.remove())})}findNgContentAttributes(){let t=5,n=this.#n,i=this.#t.attributes;return Array.from(i).find(a=>a.name.startsWith("_ngcontent-"))?.name||""}renderErrors(t){if(this.#e.innerHTML="",this.showError()&&(this.#e.innerHTML=`<span class="error">${this.showError()}</span>`),t.length>0){let n=this.#r.createElement("ul");t.forEach(i=>{let s=this.#r.createElement("li");s.innerText=i,n.appendChild(s)}),this.#e.appendChild(n)}}attachErrorContainer(){this.#e.parentElement!==this.#n&&this.#n?.appendChild(this.#e)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275dir=V({type:r,selectors:[["","showError",""]],inputs:{showError:[1,"showError"]}})}}return r})();export{Wt as a,Xt as b,Ie as c,st as d,Yt as e,Qt as f,xt as g,Jt as h,er as i,tr as j,rr as k,Vt as l,nr as m,ir as n,Re as o,sr as p,or as q,ar as r,fr as s};
