import{a as c,b as l,c as p}from"./chunk-BQETD37H.js";import{$ as h,X as a,ca as u,ea as r,l as o}from"./chunk-HN5AROX3.js";var f=60*1e3,d=5*f,m=new u("HttpGetCachingDefaultExpiry",{providedIn:"root",factory:()=>d}),x=new c(()=>!1),C=new c(()=>0);var H=(t,s)=>(t.context||(t.context=new l),t.context=t.context.set(x,!0),s&&(t.context=t.context.set(C,s)),t);function I(t,s){if(!t.context.get(x))return s(t);let n=r(w);if(t.method!=="GET")return(t.method==="POST"||t.method==="PUT"||t.method==="DELETE"||t.method==="PATCH")&&n.purge(t.url),s(t);let i=n.get(t.url);return i?o(i):s(t).pipe(a(e=>{!(e instanceof p)||e.status<200||e.status>=300||n.set(t.url,e)}))}var w=(()=>{class t{constructor(){this.#t=new Map,this.#n=0,this.#i=void 0,this.#e=r(m),this.cleanUrl=n=>{let i=new URL(n),e=`${i.hostname}${i.pathname}`;return e.endsWith("/")&&e.length>1?e.slice(0,-1):e},this.#s=()=>{let n=Date.now();for(let[i,e]of this.#t.entries())n>e.expiresOn&&this.#t.delete(i)}}#t;#n;#i;#e;get(n){let i=this.cleanUrl(n),e=this.#t.get(i);if(e){if(Date.now()<e.expiresOn)return e.expiresOn=Date.now()+this.#e,this.scheduleCacheCleanup(this.#e+50),e.response;this.#t.delete(i)}}set(n,i){let e=this.cleanUrl(n);this.scheduleCacheCleanup(this.#e+50),this.#t.set(e,{expiresOn:Date.now()+this.#e,response:i})}purge(n){let i=this.cleanUrl(n);this.#t.delete(i)}#s;scheduleCacheCleanup(n){clearTimeout(this.#i),!(this.#n+Math.min(15*f,4*n)<Date.now()&&(this.#n=Date.now(),this.#s(),this.#t.size===0))&&(this.#i=setTimeout(this.#s,n))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{H as a,I as b,w as c};
