import{a as P}from"./chunk-OZD4UVZE.js";import{g as H}from"./chunk-NE3XWMKB.js";import"./chunk-QF5K4MHH.js";import{$ as L,A as B,Dc as z,Ec as G,Hb as M,Jb as j,L as E,Lb as F,Mb as O,N as y,Nb as N,Sb as o,Tb as r,U as S,Ub as q,V,W as A,Xa as c,Y as w,Yb as R,Zb as W,bc as u,cc as h,e as b,ea as T,f as U,ja as d,ka as p,kb as I,p as x,pc as a,q as l,qc as v,r as k,s as C,sc as Y,z as D}from"./chunk-JMJSAENN.js";import{a as f,b as _}from"./chunk-DAQOROHW.js";var J=import("./chance-WQ5CIRSR.js").then(s=>s).then(({default:s})=>new s);var K=(()=>{class s{constructor(){this.flush$=new b,this.updatedUsers$=new b,this.allUsers$=this.flush$.pipe(C(()=>this.updatedUsers$),V([]),S({bufferSize:1,refCount:!1})),this.admins$=this.allUsers$.pipe(l(t=>t.filter(e=>e.isAdmin))),this.users$=this.allUsers$.pipe(l(t=>t.filter(e=>!e.isAdmin))),this.flushCache()}async addUsers(t){let e=await x(this.allUsers$),i=e.length,n=await Promise.all(Array.from({length:t}).map(async(m,g)=>_(f({},await X()),{id:P()})));this.updatedUsers$.next(e.concat(n))}async saveUser(t){let e=await x(this.allUsers$),i=e.findIndex(n=>n.id===t.id);if(i>-1)Object.assign(e[i],t);else{let n=P();e.unshift(_(f({},t),{id:n}))}this.updatedUsers$.next(e)}async deleteUser(t){let e=(await x(this.allUsers$)).filter(i=>i.id!==t.id);this.updatedUsers$.next(e)}async flushCache(){let t=await J;await new Promise(e=>setTimeout(e)),this.flush$.next(),D(0,250).pipe(w(()=>this.addUsers(t.integer({min:100,max:400}))),E(20)).subscribe()}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=L({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();async function X(){let s=await J;return{userState:s.integer({min:0,max:3}),username:s.name(),isAdmin:s.bool(),isActive:s.bool(),email:s.email()}}function Z(s,$){if(s&1&&(o(0,"tr")(1,"td"),a(2),r(),o(3,"td"),a(4),r(),o(5,"td"),a(6),r()()),s&2){let t=$.$implicit;c(2),v(t.id),c(2),v(t.username),c(2),v(t.email)}}function tt(s,$){if(s&1){let t=R();o(0,"section"),a(1),q(2,"br"),o(3,"label"),a(4,"Search "),o(5,"input",0),u("input",function(i){d(t);let n=h();return p(n.setProp("search",i))}),r()(),o(6,"div",1)(7,"button",2),u("click",function(i){d(t);let n=h();return p(n.setProp("sort",i))}),a(8,"none"),r(),o(9,"button",3),u("click",function(i){d(t);let n=h();return p(n.setProp("sort",i))}),a(10,"username"),r(),o(11,"button",4),u("click",function(i){d(t);let n=h();return p(n.setProp("sort",i))}),a(12,"email"),r(),o(13,"button",5),u("click",function(i){d(t);let n=h();return p(n.setProp("sort",i))}),a(14,"id"),r()(),o(15,"div",6)(16,"input",7),u("input",function(i){d(t);let n=h();return p(n.setProp("position",i))}),r(),o(17,"table")(18,"tbody"),O(19,Z,7,3,"tr",null,F),r()()()()}if(s&2){let t=$;c(),Y(" Available users:",t.users.length," (Loading done:",t.done,"%)"),c(15),W("max",t.users.length/t.state.pageSize),c(3),N(t.page)}}var pt=(()=>{class s{constructor(){this.user=T(K),this.state$=new U({pageSize:20,position:0,search:"",sort:""}),this.users$=this.state$.pipe(l(t=>t.sort),y(),A(t=>this.user.allUsers$.pipe(l(e=>t===""?e:e.sort((i,n)=>i[t]<n[t]?-1:1))))),this.doneLoadingPer$=B(100).pipe(E(1e3),w(()=>this.user.addUsers(500)),l(t=>Math.ceil(t/1e3*100))),this.curPage$=this.state$.pipe(y(),C(t=>this.users$.pipe(l(e=>this.findFirst(e,t))))),this.vm$=k({users:this.users$,state:this.state$,page:this.curPage$,done:this.doneLoadingPer$})}findFirst(t,{position:e,pageSize:i,search:n}){if(!n)return t.slice(e*i,e*i+i);let m=0,g=[];for(;m<t.length&&g.length<i;)t[m].username.toLowerCase().includes(n.toLowerCase())&&g.push(t[m]),m+=1;return g}setProp(t,e){let i=e.target,n=this.state$.value,m=typeof n[t]=="number";this.state$.next(_(f({},n),{[t]:m?i.valueAsNumber:i.value}))}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=I({type:s,selectors:[["app-big-data"]],decls:4,vars:3,consts:[[3,"input"],["id","buttons"],["value","",3,"click"],["value","username",3,"click"],["value","email",3,"click"],["value","id",3,"click"],["id","scroll"],["type","range",3,"input","max"]],template:function(e,i){if(e&1&&(o(0,"h1"),a(1,"Big data and performance demo"),r(),M(2,tt,21,3,"section"),z(3,"async")),e&2){let n;c(2),j((n=G(3,1,i.vm$))?2:-1,n)}},dependencies:[H],styles:["#scroll[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 1fr}#buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,154px)}#scroll[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{transform:translateY(-100%) rotate(90deg);transform-origin:left bottom;width:20rem;height:40px}"],changeDetection:0})}}return s})();export{pt as BigDataComponent};
