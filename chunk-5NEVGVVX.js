import{a as qe,d as Be,e as We}from"./chunk-IHPZU2R7.js";import{Ba as _,Ea as Ve,Fc as Ue,Gc as A,Hc as a,Ic as H,Jc as ie,Pc as Ge,Yc as se,Zc as Ze,a as v,cb as He,ea as m,ia as ne,lb as V,na as j,oa as xe,pa as je,ra as _e,sb as Ke,va as k,xc as $e}from"./chunk-LWK3ZSJS.js";import{a as te,b as re}from"./chunk-DAQOROHW.js";function b(r){return Array.isArray(r)}function p(r){return(typeof r=="object"||typeof r=="function")&&r!=null}function R(r,e,t,n){let i=r.structure.childrenMap();if(!i)return e;let s=e;for(let o of i.values()){if(n?.(s))break;s=t(o,s)}return s}function gt(r){return!r}function Xe(r){return r}function yt(r){return r.errors().length>0?"invalid":r.pending()?"unknown":"valid"}var ae=class{node;constructor(e){this.node=e}rawSyncTreeErrors=a(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncTreeErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawSyncTreeErrors()??[]]);syncErrors=a(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncErrors.compute(this.node.context),...this.syncTreeErrors(),...mt(this.node.submitState.serverErrors())]);syncValid=a(()=>this.shouldSkipValidation()?!0:R(this.node,this.syncErrors().length===0,(e,t)=>t&&e.validationState.syncValid(),gt));syncTreeErrors=a(()=>this.rawSyncTreeErrors().filter(e=>e.field===this.node.fieldProxy));rawAsyncErrors=a(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.asyncErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawAsyncErrors()??[]]);asyncErrors=a(()=>this.shouldSkipValidation()?[]:this.rawAsyncErrors().filter(e=>e==="pending"||e.field===this.node.fieldProxy));errors=a(()=>[...this.syncErrors(),...this.asyncErrors().filter(e=>e!=="pending")]);errorSummary=a(()=>R(this.node,this.errors(),(e,t)=>[...t,...e.errorSummary()]));pending=a(()=>R(this.node,this.asyncErrors().includes("pending"),(e,t)=>t||e.validationState.asyncErrors().includes("pending")));status=a(()=>{if(this.shouldSkipValidation())return"valid";let e=yt(this);return R(this.node,e,(t,n)=>n==="invalid"||t.validationState.status()==="invalid"?"invalid":n==="unknown"||t.validationState.status()==="unknown"?"unknown":"valid",t=>t==="invalid")});valid=a(()=>this.status()==="valid");invalid=a(()=>this.status()==="invalid");shouldSkipValidation=a(()=>this.node.hidden()||this.node.disabled()||this.node.readonly())};function mt(r){return r===void 0?[]:b(r)?r:[r]}function Te(r,e){if(b(r))for(let t of r)t.field??=e;else r&&(r.field??=e);return r}var de=Symbol(),X=Symbol(),L=class{predicates;fns=[];constructor(e){this.predicates=e}push(e){this.fns.push(Ye(this.predicates,e))}mergeIn(e){let t=this.predicates?e.fns.map(n=>Ye(this.predicates,n)):e.fns;this.fns.push(...t)}},$=class extends L{get defaultValue(){return!1}compute(e){return this.fns.some(t=>{let n=t(e);return n&&n!==X})}},D=class r extends L{ignore;static ignoreNull(e){return new r(e,t=>t===null)}constructor(e,t){super(e),this.ignore=t}get defaultValue(){return[]}compute(e){return this.fns.reduce((t,n)=>{let i=n(e);return i===void 0||i===X?t:b(i)?[...t,...this.ignore?i.filter(s=>!this.ignore(s)):i]:this.ignore&&this.ignore(i)?t:[...t,i]},[])}},ue=class extends D{constructor(e){super(e,void 0)}},le=class extends L{key;get defaultValue(){return this.key.getInitial()}constructor(e,t){super(e),this.key=t}compute(e){if(this.fns.length===0)return this.key.getInitial();let t=this.key.getInitial();for(let n=0;n<this.fns.length;n++){let i=this.fns[n](e);i!==X&&(t=this.key.reduce(t,i))}return t}};function Ye(r,e){return r.length===0?e:t=>{for(let n of r){let i=t.stateOf(n.path),s=A(i.structure.pathKeys).length-n.depth;for(let o=0;o<s;o++)i=i.structure.parent;if(!n.fn(i.context))return X}return e(t)}}var I=class{predicates;hidden;disabledReasons;readonly;syncErrors;syncTreeErrors;asyncErrors;aggregateProperties=new Map;propertyFactories=new Map;constructor(e){this.predicates=e,this.hidden=new $(e),this.disabledReasons=new ue(e),this.readonly=new $(e),this.syncErrors=D.ignoreNull(e),this.syncTreeErrors=D.ignoreNull(e),this.asyncErrors=D.ignoreNull(e)}hasAggregateProperty(e){return this.aggregateProperties.has(e)}getAggregatePropertyEntries(){return this.aggregateProperties.entries()}getPropertyFactoryEntries(){return this.propertyFactories.entries()}getAggregateProperty(e){return this.aggregateProperties.has(e)||this.aggregateProperties.set(e,new le(this.predicates,e)),this.aggregateProperties.get(e)}addPropertyFactory(e,t){if(this.propertyFactories.has(e))throw new Error("Can't define value twice for the same Property");this.propertyFactories.set(e,t)}mergeIn(e){this.hidden.mergeIn(e.hidden),this.disabledReasons.mergeIn(e.disabledReasons),this.readonly.mergeIn(e.readonly),this.syncErrors.mergeIn(e.syncErrors),this.syncTreeErrors.mergeIn(e.syncTreeErrors),this.asyncErrors.mergeIn(e.asyncErrors);for(let[t,n]of e.getAggregatePropertyEntries())this.getAggregateProperty(t).mergeIn(n);for(let[t,n]of e.getPropertyFactoryEntries())this.addPropertyFactory(t,n)}},he=0;function pt(){return he}function S(r,e){return(...t)=>{try{return he=e,r(...t)}finally{he=0}}}var U=class{depth;constructor(e){this.depth=e}build(){return new G(this,[],0)}},C=class r extends U{constructor(e){super(e)}current;all=[];addHiddenRule(e){this.getCurrent().addHiddenRule(e)}addDisabledReasonRule(e){this.getCurrent().addDisabledReasonRule(e)}addReadonlyRule(e){this.getCurrent().addReadonlyRule(e)}addSyncErrorRule(e){this.getCurrent().addSyncErrorRule(e)}addSyncTreeErrorRule(e){this.getCurrent().addSyncTreeErrorRule(e)}addAsyncErrorRule(e){this.getCurrent().addAsyncErrorRule(e)}addAggregatePropertyRule(e,t){this.getCurrent().addAggregatePropertyRule(e,t)}addPropertyFactory(e,t){this.getCurrent().addPropertyFactory(e,t)}getChild(e){return this.getCurrent().getChild(e)}hasLogic(e){return this===e?!0:this.all.some(({builder:t})=>t.hasLogic(e))}mergeIn(e,t){t?this.all.push({builder:e,predicate:{fn:S(t.fn,this.depth),path:t.path}}):this.all.push({builder:e}),this.current=void 0}getCurrent(){return this.current===void 0&&(this.current=new O(this.depth),this.all.push({builder:this.current})),this.current}static newRoot(){return new r(0)}},O=class extends U{logic=new I([]);children=new Map;constructor(e){super(e)}addHiddenRule(e){this.logic.hidden.push(S(e,this.depth))}addDisabledReasonRule(e){this.logic.disabledReasons.push(S(e,this.depth))}addReadonlyRule(e){this.logic.readonly.push(S(e,this.depth))}addSyncErrorRule(e){this.logic.syncErrors.push(S(e,this.depth))}addSyncTreeErrorRule(e){this.logic.syncTreeErrors.push(S(e,this.depth))}addAsyncErrorRule(e){this.logic.asyncErrors.push(S(e,this.depth))}addAggregatePropertyRule(e,t){this.logic.getAggregateProperty(e).push(S(t,this.depth))}addPropertyFactory(e,t){this.logic.addPropertyFactory(e,S(t,this.depth))}getChild(e){return this.children.has(e)||this.children.set(e,new C(this.depth+1)),this.children.get(e)}hasLogic(e){return this===e}},G=class r{builder;predicates;depth;logic;constructor(e,t,n){this.builder=e,this.predicates=t,this.depth=n,this.logic=e?bt(e,t,n):new I([])}getChild(e){let t=this.builder?tt(this.builder,e):[];if(t.length===0)return new r(void 0,[],this.depth+1);if(t.length===1){let{builder:n,predicates:i}=t[0];return new r(n,[...this.predicates,...i.map(s=>fe(s,this.depth))],this.depth+1)}else{let n=t.map(({builder:i,predicates:s})=>new r(i,[...this.predicates,...s.map(o=>fe(o,this.depth))],this.depth+1));return new ce(n)}}hasLogic(e){return this.builder?.hasLogic(e)??!1}},ce=class r{all;logic;constructor(e){this.all=e,this.logic=new I([]);for(let t of e)this.logic.mergeIn(t.logic)}getChild(e){return new r(this.all.flatMap(t=>t.getChild(e)))}hasLogic(e){return this.all.some(t=>t.hasLogic(e))}};function tt(r,e){if(r instanceof C)return r.all.flatMap(({builder:t,predicate:n})=>{let i=tt(t,e);return n?i.map(({builder:s,predicates:o})=>({builder:s,predicates:[...o,n]})):i});if(r instanceof O){if(r.children.has(e))return[{builder:r.children.get(e),predicates:[]}]}else throw new Error("Unknown LogicNodeBuilder type");return[]}function bt(r,e,t){let n=new I(e);if(r instanceof C){let i=r.all.map(({builder:s,predicate:o})=>new G(s,o?[...e,fe(o,t)]:e,t));for(let s of i)n.mergeIn(s.logic)}else if(r instanceof O)n.mergeIn(r.logic);else throw new Error("Unknown LogicNodeBuilder type");return n}function fe(r,e){return re(te({},r),{depth:e})}var rt=Symbol("PATH"),f=class r{keys;logic;root;children=new Map;fieldPathProxy=new Proxy(this,vt);constructor(e,t,n){this.keys=e,this.logic=t,this.root=n??this}get element(){return this.getChild(de)}getChild(e){return this.children.has(e)||this.children.set(e,new r([...this.keys,e],this.logic.getChild(e),this.root)),this.children.get(e)}mergeIn(e,t){let n=e.compile();this.logic.mergeIn(n.logic,t)}static unwrapFieldPath(e){return e[rt]}static newRoot(){return new r([],C.newRoot(),void 0)}},vt={get(r,e){return e===rt?r:r.getChild(e).fieldPathProxy}},K,z=new Map,M=class r{schemaFn;constructor(e){this.schemaFn=e}compile(){if(z.has(this))return z.get(this);let e=f.newRoot();z.set(this,e);let t=K;try{K=e,this.schemaFn(e.fieldPathProxy)}finally{K=t}return e}static create(e){return e instanceof r?e:new r(e)}static rootCompile(e){try{return z.clear(),e===void 0?f.newRoot():e instanceof r?e.compile():new r(e).compile()}finally{z.clear()}}};function St(r){return r instanceof M||typeof r=="function"}function w(r){if(K!==f.unwrapFieldPath(r).root)throw new Error("A FieldPath can only be used directly within the Schema that owns it, **not** outside of it or within a sub-schema.")}var Z=class{brand;constructor(){}};function wt(){return new Z}var q=class{reduce;getInitial;brand;constructor(e,t){this.reduce=e,this.getInitial=t}};function Y(r,e){return new q(r,e)}function Et(){return Y((r,e)=>e===void 0?r:[...r,e],()=>[])}function nt(){return Y((r,e)=>r===void 0?e:e===void 0?r:Math.min(r,e),()=>{})}function it(){return Y((r,e)=>r===void 0?e:e===void 0?r:Math.max(r,e),()=>{})}function Nt(){return Y((r,e)=>r||e,()=>!1)}var B=Nt(),Qe=it(),Je=nt(),ge=it(),ye=nt(),At=Et();function Yt(r,e){w(r),f.unwrapFieldPath(r).logic.addDisabledReasonRule(n=>{let i=!0;return typeof e=="string"?i=e:e&&(i=e(n)),typeof i=="string"?{field:n.field,message:i}:i?{field:n.field}:void 0})}function Qt(r,e=()=>!0){w(r),f.unwrapFieldPath(r).logic.addReadonlyRule(e)}function ze(r,e){w(r),f.unwrapFieldPath(r).logic.addSyncErrorRule(n=>Te(e(n),n.field))}function Le(r,e,t){w(r),f.unwrapFieldPath(r).logic.addAggregatePropertyRule(e,t)}function Q(r,...e){w(r);let t,n;return e.length===2?[t,n]=e:[n]=e,t??=wt(),f.unwrapFieldPath(r).logic.addPropertyFactory(t,n),t}function Jt(r,e){w(r);let t=f.unwrapFieldPath(r),n=Q(r,i=>{let s=a(()=>{let d=i.stateOf(r).validationState;if(!(d.shouldSkipValidation()||!d.syncValid()))return e.params(i)});return e.factory(s)});t.logic.addAsyncErrorRule(i=>{let s=i.state.property(n);switch(s.status()){case"idle":return;case"loading":case"reloading":return"pending";case"resolved":case"local":if(!s.hasValue())return;let o=e.errors(s.value(),i);return Te(o,i.field);case"error":throw s.error()}})}var me=class{field;constructor(e){this.field=e}control=this;get value(){return this.field().value()}get valid(){return this.field().valid()}get invalid(){return this.field().invalid()}get pending(){return this.field().pending()}get disabled(){return this.field().disabled()}get enabled(){return!this.field().disabled()}get errors(){let e=this.field().errors();if(e.length===0)return null;let t={};for(let n of e)t[n.kind]=n;return t}get pristine(){return!this.field().dirty()}get dirty(){return this.field().dirty()}get touched(){return this.field().touched()}get untouched(){return!this.field().touched()}get status(){if(this.field().disabled())return"DISABLED";if(this.field().valid())return"VALID";if(this.field().invalid())return"INVALID";if(this.field().pending())return"PENDING";throw Error("AssertionError: unknown form control status")}valueAccessor=null;hasValidator(e){return e===Be.required?this.field().property(B)():!1}updateValueAndValidity(){}};function Pt(r){if(Rt(r),!(r._tNode.directiveStart===0||r._tNode.componentOffset===-1))return r._lView[r._tNode.directiveStart+r._tNode.componentOffset]}function Mt(r,e){r[v].applyValueToInputSignal(r[v],e)}function g(r){return st(r)}function F(r){return st(r)&&p(r)&&"subscribe"in r}function kt(r){r[v].run()}function Rt(r){if(!("_tNode"in r))throw new Error("Expected a Node Injector")}function st(r){if(!p(r)||!(v in r))return!1;let e=r[v];return p(e)&&"applyValueToInputSignal"in e}var ot=(()=>{class r{injector=m(j);renderer=m(He);initialized=!1;field=k(void 0);set _field(t){this.field.set(t),this.initialized||this.initialize()}state=a(()=>this.field()());el=m(_);cvaArray=m(qe,{optional:!0});_ngControl;get ngControl(){return this._ngControl??=new me(()=>this.state())}get cva(){return this.cvaArray?.[0]??this._ngControl?.valueAccessor??void 0}initialize(){this.initialized=!0;let t=this.injector,n=Pt(t);if(!(n&&It(n))){if(n&&Dt(n))this.setupCustomUiControl(n);else if(this.cva!==void 0)this.setupControlValueAccessor(this.cva);else if(this.el.nativeElement instanceof HTMLInputElement||this.el.nativeElement instanceof HTMLTextAreaElement||this.el.nativeElement instanceof HTMLSelectElement)this.setupNativeInput(this.el.nativeElement);else throw new Error("Unhandled control?");H(i=>{let s=this.state();s.nodeState.controls.update(o=>[...o,this]),i(()=>{s.nodeState.controls.update(o=>o.filter(d=>d!==this))})},{injector:this.injector})}}setupNativeInput(t){let n=t instanceof HTMLTextAreaElement?"text":t instanceof HTMLSelectElement?"select":t.type;switch(t.addEventListener("input",()=>{switch(n){case"checkbox":this.state().value.set(t.checked);break;case"radio":this.state().value.set(t.value);break;case"number":case"range":case"datetime-local":typeof this.state().value()=="number"?this.state().value.set(t.valueAsNumber):this.state().value.set(t.value);break;case"date":case"month":case"week":case"time":et(this.state().value())?this.state().value.set(t.valueAsDate):typeof this.state().value()=="number"?this.state().value.set(t.valueAsNumber):this.state().value.set(t.value);break;default:this.state().value.set(t.value);break}this.state().markAsDirty()}),t.addEventListener("blur",()=>this.state().markAsTouched()),this.maybeSynchronize(()=>this.state().readonly(),this.withBooleanAttribute(t,"readonly")),this.maybeSynchronize(()=>this.state().disabled(),this.withBooleanAttribute(t,"disabled")),this.maybeSynchronize(()=>this.state().name(),this.withAttribute(t,"name")),this.maybeSynchronize(this.propertySource(B),this.withBooleanAttribute(t,"required")),this.maybeSynchronize(this.propertySource(Qe),this.withAttribute(t,"min")),this.maybeSynchronize(this.propertySource(ge),this.withAttribute(t,"minLength")),this.maybeSynchronize(this.propertySource(Je),this.withAttribute(t,"max")),this.maybeSynchronize(this.propertySource(ye),this.withAttribute(t,"maxLength")),n){case"checkbox":this.maybeSynchronize(()=>this.state().value(),i=>t.checked=i);break;case"radio":this.maybeSynchronize(()=>this.state().value(),i=>{t.checked=t.value===i});break;case"select":this.maybeSynchronize(()=>this.state().value(),i=>{Ke(()=>t.value=i,{injector:this.injector})});break;case"number":case"range":case"datetime-local":this.maybeSynchronize(()=>this.state().value(),i=>{typeof i=="number"?t.valueAsNumber=i:t.value=i});break;case"date":case"month":case"week":case"time":this.maybeSynchronize(()=>this.state().value(),i=>{et(i)?t.valueAsDate=i:typeof i=="number"?t.valueAsNumber=i:t.value=i});break;default:this.maybeSynchronize(()=>this.state().value(),i=>{t.value=i});break}}setupControlValueAccessor(t){t.registerOnChange(n=>this.state().value.set(n)),t.registerOnTouched(()=>this.state().markAsTouched()),this.maybeSynchronize(()=>this.state().value(),n=>t.writeValue(n)),t.setDisabledState&&this.maybeSynchronize(()=>this.state().disabled(),n=>t.setDisabledState(n)),t.writeValue(this.state().value()),t.setDisabledState?.(this.state().disabled())}setupCustomUiControl(t){let n;if(at(t))this.maybeSynchronize(()=>this.state().value(),h(t.value)),n=t.value.subscribe(o=>this.state().value.set(o));else if(dt(t))this.maybeSynchronize(()=>this.state().value(),h(t.checked)),n=t.checked.subscribe(o=>this.state().value.set(o));else throw new Error("Unknown custom control subtype");this.maybeSynchronize(()=>this.state().name(),h(t.name)),this.maybeSynchronize(()=>this.state().disabled(),h(t.disabled)),this.maybeSynchronize(()=>this.state().disabledReasons(),h(t.disabledReasons)),this.maybeSynchronize(()=>this.state().readonly(),h(t.readonly)),this.maybeSynchronize(()=>this.state().hidden(),h(t.hidden)),this.maybeSynchronize(()=>this.state().errors(),h(t.errors)),(F(t.touched)||g(t.touched))&&this.maybeSynchronize(()=>this.state().touched(),h(t.touched)),this.maybeSynchronize(()=>this.state().dirty(),h(t.dirty)),this.maybeSynchronize(()=>this.state().invalid(),h(t.invalid)),this.maybeSynchronize(()=>this.state().pending(),h(t.pending)),this.maybeSynchronize(this.propertySource(B),h(t.required)),this.maybeSynchronize(this.propertySource(Qe),h(t.min)),this.maybeSynchronize(this.propertySource(ge),h(t.minLength)),this.maybeSynchronize(this.propertySource(Je),h(t.max)),this.maybeSynchronize(this.propertySource(ye),h(t.maxLength)),this.maybeSynchronize(this.propertySource(At),h(t.pattern));let i,s;if(F(t.touched)||ut(t.touched))i=t.touched.subscribe(()=>this.state().markAsTouched());else{let o=d=>{let E=d.relatedTarget;this.el.nativeElement.contains(E)||this.state().markAsTouched()};this.el.nativeElement.addEventListener("focusout",o),s=()=>this.el.nativeElement.removeEventListener("focusout",o)}this.injector.get(je).onDestroy(()=>{n?.unsubscribe(),i?.unsubscribe(),s?.()})}maybeSynchronize(t,n){if(!n)return;let i=H(()=>{let s=t();A(()=>n(s))},{injector:this.injector});kt(i)}propertySource(t){let n=a(()=>this.state().hasProperty(t)?this.state().property(t):t.getInitial);return()=>n()?.()}withAttribute(t,n){return i=>{i!==void 0?this.renderer.setAttribute(t,n,i.toString()):this.renderer.removeAttribute(t,n)}}withBooleanAttribute(t,n){return i=>{i?this.renderer.setAttribute(t,n,""):this.renderer.removeAttribute(t,n)}}static \u0275fac=function(n){return new(n||r)};static \u0275dir=V({type:r,selectors:[["","control",""]],inputs:{_field:[0,"control","_field"]},features:[$e([{provide:We,useFactory:()=>m(r).ngControl}])]})}return r})();function h(r){return r?e=>Mt(r,e):void 0}function Dt(r){let e=r;return(at(e)||dt(e))&&(e.readonly===void 0||g(e.readonly))&&(e.disabled===void 0||g(e.disabled))&&(e.disabledReasons===void 0||g(e.disabledReasons))&&(e.errors===void 0||g(e.errors))&&(e.invalid===void 0||g(e.invalid))&&(e.pending===void 0||g(e.pending))&&(e.touched===void 0||F(e.touched)||g(e.touched)||ut(e.touched))&&(e.dirty===void 0||g(e.dirty))&&(e.min===void 0||g(e.min))&&(e.minLength===void 0||g(e.minLength))&&(e.max===void 0||g(e.max))&&(e.maxLength===void 0||g(e.maxLength))}function at(r){return F(r.value)}function dt(r){return F(r.checked)&&r.value===void 0}function It(r){return Ze(r.constructor)?.inputs.some(t=>t.templateName==="control")??!1}function ut(r){return r instanceof Ue||r instanceof _e}function et(r){return r===null||r instanceof Date}var pe=class{node;cache=new WeakMap;constructor(e){this.node=e}resolve(e){if(!this.cache.has(e)){let t=a(()=>{let n=f.unwrapFieldPath(e),i=this.node,s=pt();for(;s>0||!i.structure.logic.hasLogic(n.root.logic);)if(s--,i=i.structure.parent,i===void 0)throw new Error("Path is not part of this field tree.");for(let o of n.keys)if(i=i.structure.getChild(o),i===void 0)throw new Error(`Cannot resolve path .${n.keys.join(".")} relative to field ${["<root>",...this.node.structure.pathKeys()].join(".")}.`);return i.fieldProxy});this.cache.set(e,t)}return this.cache.get(e)()}get field(){return this.node.fieldProxy}get state(){return this.node}get value(){return this.node.structure.value}get key(){return this.node.structure.keyInParent}index=a(()=>{let e=this.key();if(!b(A(this.node.structure.parent.value)))throw new Error("RuntimeError: cannot access index, parent field is not an array");return Number(e)});fieldOf=e=>this.resolve(e);stateOf=e=>this.resolve(e)();valueOf=e=>this.resolve(e)().value()},be=class{node;properties=new Map;constructor(e){this.node=e,A(()=>ne(this.node.structure.injector,()=>{for(let[t,n]of this.node.logicNode.logic.getPropertyFactoryEntries())this.properties.set(t,n(this.node.context))}))}get(e){if(e instanceof Z)return this.properties.get(e);if(!this.properties.has(e)){let t=this.node.logicNode.logic.getAggregateProperty(e),n=a(()=>t.compute(this.node.context));this.properties.set(e,n)}return this.properties.get(e)}has(e){return e instanceof q?this.node.logicNode.logic.hasAggregateProperty(e):this.properties.has(e)}},Ct={get(r,e){let t=r(),n=t.structure.getChild(e);if(n!==void 0)return n.fieldProxy;let i=A(t.value);if(b(i)){if(e==="length")return t.value().length;if(e===Symbol.iterator)return Array.prototype[e]}}};function Tt(r,e){let t=a(()=>r()[e()]);return t[v]=r[v],t.set=n=>{r.update(i=>zt(i,n,e()))},t.update=n=>{t.set(n(A(t)))},t.asReadonly=()=>t,t}function zt(r,e,t){if(b(r)){let n=[...r];return n[t]=e,n}else return re(te({},r),{[t]:e})}var W=class{logic;identitySymbol=Symbol();_injector=void 0;get injector(){return this._injector??=j.create({providers:[],parent:this.fieldManager.injector}),this._injector}constructor(e){this.logic=e}children(){return this.childrenMap()?.values()??[]}getChild(e){let t=this.childrenMap(),n=this.value();if(!(!t||!p(n))){if(b(n)){let i=n[e];p(i)&&i.hasOwnProperty(this.identitySymbol)&&(e=i[this.identitySymbol])}return t.get(typeof e=="number"?e.toString():e)}}destroy(){this.injector.destroy()}},ve=class extends W{node;fieldManager;value;get parent(){}get root(){return this.node}get pathKeys(){return Lt}get keyInParent(){return Ot}childrenMap;constructor(e,t,n,i,s,o,d){super(n),this.node=e,this.fieldManager=i,this.value=s,this.childrenMap=lt(e,s,this.identitySymbol,t,n,o,d)}},Se=class extends W{parent;root;pathKeys;keyInParent;value;childrenMap;get fieldManager(){return this.root.structure.fieldManager}constructor(e,t,n,i,s,o,d,E){if(super(n),this.parent=i,this.root=this.parent.structure.root,this.pathKeys=a(()=>[...i.structure.pathKeys(),this.keyInParent()]),s===void 0){let u=o;this.keyInParent=a(()=>{if(i.structure.childrenMap()?.get(u)!==e)throw new Error(`RuntimeError: orphan field, looking for property '${u}' of ${oe(i)}`);return u})}else{let u=o;this.keyInParent=a(()=>{let N=i.structure.value();if(!b(N))throw new Error(`RuntimeError: orphan field, expected ${oe(i)} to be an array`);let c=N[u];if(p(c)&&c.hasOwnProperty(i.structure.identitySymbol)&&c[i.structure.identitySymbol]===s)return u;for(let l=0;l<N.length;l++){let y=N[l];if(p(y)&&y.hasOwnProperty(i.structure.identitySymbol)&&y[i.structure.identitySymbol]===s)return u=l.toString()}throw new Error(`RuntimeError: orphan field, can't find element in array ${oe(i)}`)})}this.value=Tt(this.parent.structure.value,this.keyInParent),this.childrenMap=lt(e,this.value,this.identitySymbol,t,n,d,E),this.fieldManager.structures.add(this)}};var Lt=a(()=>[]),Ot=a(()=>{throw new Error("RuntimeError: the top-level field in the form has no parent")});function lt(r,e,t,n,i,s,o){return ie({source:e,computation:(d,E)=>{let u=E?.value;if(!p(d))return;let N=b(d);if(u!==void 0){let c;if(N){c=new Set(u.keys());for(let l=0;l<d.length;l++){let y=d[l];p(y)&&y.hasOwnProperty(t)?c.delete(y[t]):c.delete(l.toString())}for(let l of c)u.delete(l)}else for(let l of u.keys())d.hasOwnProperty(l)||u.delete(l)}for(let c of Object.keys(d)){let l,y=d[c];if(y===void 0){u?.delete(c);continue}N&&p(y)&&(l=y[t]??=Symbol(""));let Fe=l??c;if(u?.has(Fe))continue;let J,ee;N?(J=n.getChild(de),ee=i.getChild(de)):(J=n.getChild(c),ee=i.getChild(c)),u??=new Map,u.set(Fe,o({kind:"child",parent:r,pathNode:J,logic:ee,initialKeyInParent:c,identityInParent:l,fieldAdapter:s}))}return u},equal:()=>!1})}function oe(r){return`<root>.${r.structure.pathKeys().join(".")}`}var we=class{node;selfSubmitting=k(!1);serverErrors;constructor(e){this.node=e,this.serverErrors=ie({source:this.node.structure.value,computation:()=>[]})}submitting=a(()=>this.selfSubmitting()||(this.node.structure.parent?.submitting()??!1))},x=class r{structure;validationState;propertyState;nodeState;submitState;_context=void 0;fieldAdapter;get context(){return this._context??=new pe(this)}fieldProxy=new Proxy(()=>this,Ct);constructor(e){this.fieldAdapter=e.fieldAdapter,this.structure=this.fieldAdapter.createStructure(this,e),this.validationState=this.fieldAdapter.createValidationState(this,e),this.nodeState=this.fieldAdapter.createNodeState(this,e),this.propertyState=new be(this),this.submitState=new we(this)}get logicNode(){return this.structure.logic}get value(){return this.structure.value}get keyInParent(){return this.structure.keyInParent}get errors(){return this.validationState.errors}get errorSummary(){return this.validationState.errorSummary}get pending(){return this.validationState.pending}get valid(){return this.validationState.valid}get invalid(){return this.validationState.invalid}get dirty(){return this.nodeState.dirty}get touched(){return this.nodeState.touched}get disabled(){return this.nodeState.disabled}get disabledReasons(){return this.nodeState.disabledReasons}get hidden(){return this.nodeState.hidden}get readonly(){return this.nodeState.readonly}get controls(){return this.nodeState.controls}get submitting(){return this.submitState.submitting}get name(){return this.nodeState.name}property(e){return this.propertyState.get(e)}hasProperty(e){return this.propertyState.has(e)}markAsTouched(){this.nodeState.markAsTouched()}markAsDirty(){this.nodeState.markAsDirty()}reset(){this.nodeState.markAsUntouched(),this.nodeState.markAsPristine();for(let e of this.structure.children())e.reset()}static newRoot(e,t,n,i){return i.newRoot(e,t,n,i)}static newChild(e){return e.fieldAdapter.newChild(e)}createStructure(e){return e.kind==="root"?new ve(this,e.pathNode,e.logic,e.fieldManager,e.value,e.fieldAdapter,r.newChild):new Se(this,e.pathNode,e.logic,e.parent,e.identityInParent,e.initialKeyInParent,e.fieldAdapter,r.newChild)}},Ee=class{node;selfTouched=k(!1);selfDirty=k(!1);markAsTouched(){this.selfTouched.set(!0)}markAsDirty(){this.selfDirty.set(!0)}markAsPristine(){this.selfDirty.set(!1)}markAsUntouched(){this.selfTouched.set(!1)}controls=k([]);constructor(e){this.node=e}dirty=a(()=>{let e=this.selfDirty()&&!this.isNonInteractive();return R(this.node,e,(t,n)=>n||t.nodeState.dirty(),Xe)});touched=a(()=>{let e=this.selfTouched()&&!this.isNonInteractive();return R(this.node,e,(t,n)=>n||t.nodeState.touched(),Xe)});disabledReasons=a(()=>[...this.node.structure.parent?.nodeState.disabledReasons()??[],...this.node.logicNode.logic.disabledReasons.compute(this.node.context)]);disabled=a(()=>!!this.disabledReasons().length);readonly=a(()=>(this.node.structure.parent?.nodeState.readonly()||this.node.logicNode.logic.readonly.compute(this.node.context))??!1);hidden=a(()=>(this.node.structure.parent?.nodeState.hidden()||this.node.logicNode.logic.hidden.compute(this.node.context))??!1);name=a(()=>{let e=this.node.structure.parent;return e?`${e.name()}.${this.node.structure.keyInParent()}`:this.node.structure.fieldManager.rootName});isNonInteractive=a(()=>this.hidden()||this.disabled()||this.readonly())},Ne=class{newRoot(e,t,n,i){return new x({kind:"root",fieldManager:e,value:t,pathNode:n,logic:n.logic.build(),fieldAdapter:i})}newChild(e){return new x(e)}createNodeState(e){return new Ee(e)}createValidationState(e){return new ae(e)}createStructure(e,t){return e.createStructure(t)}},Ae=class{injector;rootName;constructor(e,t){this.injector=e,this.rootName=t??`${this.injector.get(Ve)}.form${Ft++}`}structures=new Set;createFieldManagementEffect(e){H(()=>{let t=new Set;this.markStructuresLive(e,t);for(let n of this.structures)t.has(n)||(this.structures.delete(n),A(()=>n.destroy()))},{injector:this.injector})}markStructuresLive(e,t){t.add(e);for(let n of e.children())this.markStructuresLive(n.structure,t)}},Ft=0;function xt(r){let e,t,n;return r.length===3?[e,t,n]=r:r.length===2?St(r[1])?[e,t]=r:[e,n]=r:[e]=r,[e,t,n]}function er(...r){let[e,t,n]=xt(r),i=n?.injector??m(j),s=ne(i,()=>M.rootCompile(t)),o=new Ae(i,n?.name),d=n?.adapter??new Ne,E=x.newRoot(o,e,s,d);return o.createFieldManagementEffect(E.structure),E.fieldProxy}function tr(r,e){w(r);let t=f.unwrapFieldPath(r).element.fieldPathProxy;jt(t,e)}function jt(r,e){w(r),f.unwrapFieldPath(r).mergeIn(M.create(e))}function _t(r,e,t){w(r),f.unwrapFieldPath(r).mergeIn(M.create(t),{fn:e,path:r})}function rr(r,e,t){_t(r,({value:n})=>e(n()),t)}async function nr(r,e){let t=r();if(ht(t),!t.invalid()){t.submitState.selfSubmitting.set(!0);try{let n=await e(r);n&&Vt(t,n)}finally{t.submitState.selfSubmitting.set(!1)}}}function Vt(r,e){b(e)||(e=[e]);let t=new Map;for(let n of e){let i=Te(n,r.fieldProxy),s=i.field(),o=t.get(s);o||(o=[],t.set(s,o)),o.push(i)}for(let[n,i]of t)n.submitState.serverErrors.set(i)}function ir(r){return M.create(r)}function ht(r){r.markAsTouched();for(let e of r.structure.children())ht(e)}function Ht(r){return new Me(r)}function sr(r,e){return new ke(r,e)}function or(r,e){return new Re(r,e)}function Kt(r,e){return new De(r,e)}function $t(r,e){return new Ie(r,e)}function ar(r,e){return new Ce(r,e)}function dr(r){return new Pe(r)}var Pe=class{__brand=void 0;kind="";field;message;constructor(e){e&&Object.assign(this,e)}},P=class{__brand=void 0;kind="";field;message;constructor(e){e&&Object.assign(this,e)}},Me=class extends P{kind="required"},ke=class extends P{min;kind="min";constructor(e,t){super(t),this.min=e}},Re=class extends P{max;kind="max";constructor(e,t){super(t),this.max=e}},De=class extends P{minLength;kind="minLength";constructor(e,t){super(t),this.minLength=e}},Ie=class extends P{maxLength;kind="maxLength";constructor(e,t){super(t),this.maxLength=e}},Ce=class extends P{pattern;kind="pattern";constructor(e,t){super(t),this.pattern=e}};function ct(r){let e=r;return typeof e.length=="number"?e.length:e.size}function T(r,e){return r instanceof Function?r(e):r}function Oe(r){return typeof r=="number"?isNaN(r):r===""||r===!1||r==null}function ur(r,e,t){let n=Q(r,i=>a(()=>typeof e=="number"?e:e(i)));Le(r,ye,({state:i})=>i.property(n)()),ze(r,i=>{if(Oe(i.value()))return;let s=i.state.property(n)();if(s!==void 0&&ct(i.value())>s)return t?.error?T(t.error,i):$t(s,{message:T(t?.message,i)})})}function lr(r,e,t){let n=Q(r,i=>a(()=>typeof e=="number"?e:e(i)));Le(r,ge,({state:i})=>i.property(n)()),ze(r,i=>{if(Oe(i.value()))return;let s=i.state.property(n)();if(s!==void 0&&ct(i.value())<s)return t?.error?T(t.error,i):Kt(s,{message:T(t?.message,i)})})}function hr(r,e){let t=Q(r,n=>a(()=>e?.when?e.when(n):!0));Le(r,B,({state:n})=>n.property(t)()),ze(r,n=>{if(n.state.property(t)()&&Oe(n.value()))return e?.error?T(e.error,n):Ht({message:T(e?.message,n)})})}var pr=(()=>{class r{#i;#r;#t;#n;#e;#s;#o;constructor(){this.showError=Ge(""),this.#i=m(ot),this.#r=m(xe),this.#t=m(_).nativeElement,this.#n=this.#t.parentElement,this.#e=this.#r.createElement("div"),this.#s=a(()=>{let t=this.#i.state().errors();return!t||t.length===0?[]:t.map(n=>n?.message??JSON.stringify(n))}),this.#o=a(()=>this.#i.state().touched()),this.#e.classList.add("error-messages"),se(()=>{let t=this.#s(),n=this.findNgContentAttributes();n&&this.#e.setAttribute(n,""),t.length>0?(this.renderErrors(t),this.attachErrorContainer(),this.#t.setCustomValidity(t.join(", "))):(this.#t.setCustomValidity(""),this.#e.remove())}),se(()=>{this.#o()?this.#t.classList.add("se-touched"):this.#t.classList.remove("se-touched")})}findNgContentAttributes(){let t=5,n=this.#n,i=this.#t.attributes;return Array.from(i).find(o=>o.name.startsWith("_ngcontent-"))?.name||""}renderErrors(t){if(this.#e.innerHTML="",this.showError()&&(this.#e.innerHTML=`<span class="error">${this.showError()}</span>`),t.length>0){let n=this.#r.createElement("ul");t.forEach(i=>{let s=this.#r.createElement("li");s.innerText=i,n.appendChild(s)}),this.#e.appendChild(n)}}attachErrorContainer(){this.#e.parentElement!==this.#n&&this.#n?.appendChild(this.#e)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275dir=V({type:r,selectors:[["","showError",""]],inputs:{showError:[1,"showError"]}})}}return r})();export{Yt as a,Qt as b,ze as c,Jt as d,ot as e,er as f,tr as g,jt as h,rr as i,nr as j,ir as k,sr as l,or as m,Kt as n,ar as o,dr as p,Ie as q,ur as r,lr as s,hr as t,pr as u};
