import{$,D as A,F as D,G as h,H as u,I as d,K as C,N as M,T as p,V as S,X as v,i as g,k as r,l as f,q as s,s as b,u as y,v as R}from"./chunk-I3AI3OF7.js";import{c as P,d as j}from"./chunk-ET7QKIMK.js";import{a as l,b as w}from"./chunk-DAQOROHW.js";var o,I="sample-cache",E=!1;async function U(){try{if(o)return o;var a=await P(I);return o=a?new Map([...a]):new Map,o}catch{return o=new Map,E=!0,o}}function O(a,m){o.set(a,m),!E&&j(I,o)}function k(a){return o.has(a)}function B(a){return o.get(a)}var K=(()=>{class a{getAllPagedData(t){return r(this.load(`${t}`)).pipe(M(e=>e.next?this.load(e.next):g))}constructor(){this.baseUrl="https://swapi.dev/api/",this.swapiRoot={},this.load=async t=>{if(t=x(t),await U(),!k(t)){let e=await fetch(t).then(i=>i.json()).catch(i=>{});await O(t,e)}return B(t)},this.swapiRoot$=r(this.load(this.baseUrl)).pipe(v(t=>this.swapiRoot=t),p(1)),this.swPeople$=r(this.load(`${this.baseUrl}people/`)).pipe(M(t=>t.next?this.load(t.next):g),s(t=>t.results),h((t,e)=>t.concat(e),[]),s(t=>t.map(e=>w(l({},e),{date:L(),id:e.url}))),p(1)),this.findById=t=>this.swPeople$.pipe(s(e=>e[t]),A(Boolean),C(1)),this.swFilms$=r(this.load(`${this.baseUrl}films/`)).pipe(p(1)),this.findFilmByUrl=t=>this.get(t),this.getRandomPerson=(t=1)=>r(Array.from({length:t})).pipe(d(()=>this.swPeople$.pipe(s(e=>{let i=Math.floor(Math.random()*e.length);return e[i]}),b(e=>R(...e.films.map(i=>this.findFilmByUrl(i))).pipe(u(),s(i=>w(l({},e),{films:i}))))))),this.findIn=(t,e)=>this.getAllRows(t).pipe(s(i=>i.find(n=>(n.name||n.title||"").toLowerCase().includes(e.toLowerCase().trim())))),this.getSetNames=t=>this.getAllRows(t).pipe(s(e=>e.map(i=>i.name||i.title||""))),this.findWithName=t=>this.findIn("people",t),this.loadData().subscribe()}get(t){let e=Object.values(this.swapiRoot).find(i=>t.toLowerCase().includes(i.toLowerCase()));return e?this.getAllPagedData(e).pipe(h((i,n)=>i.concat(n.results),[]),s(i=>i.find(n=>n.url===t))):r(this.load(t))}loadData(){return this.swapiRoot$.pipe(v(t=>this.swapiRoot=t),d(t=>Object.values(t||{}).map(e=>this.getAllPagedData(e))),y(),u(),p(1))}enrich(t){let e=i=>{let n=t[i];return Array.isArray(n)&&n.length>0?r(n).pipe(d(c=>this.get(c)),u(),s(c=>({[i]:c}))):typeof n=="string"?(this.detectSet(n)?this.get(n):f(n)).pipe(s(F=>({[i]:F}))):f(n).pipe(s(c=>({[i]:c})))};return this.swapiRoot$.pipe(d(i=>Object.keys(t).map(e)),y(),h((i,n)=>l(l({},i),n),{}),D(i=>(console.warn(i),f({}))))}getAllRows(t){return this.swapiRoot$.pipe(S(()=>this.getAllPagedData(x(this.swapiRoot[t]))),s(e=>e.results),h((e,i)=>e.concat(i),[]),p(1))}detectSet(t){if(typeof t=="string"){let e=Object.entries(this.swapiRoot).find(([i,n])=>t.includes(n));return e&&e[0]}}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=$({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function L(){let a=Math.ceil(Math.random()*1e3)+1e3,m=Math.floor(Math.random()*12),t=Math.ceil(Math.random()*27);return new Date(a,m,t,12,0)}function x(a){return a.split("http:").join("https:")}export{U as a,O as b,k as c,B as d,K as e};
