import{b as w,c as O}from"./chunk-R4ONXNLX.js";import"./chunk-GICU3ROS.js";import{a as C}from"./chunk-TIPAN463.js";import"./chunk-Z7FVOOKT.js";import"./chunk-OZD4UVZE.js";import"./chunk-ZYDVTU2D.js";import"./chunk-BQETD37H.js";import"./chunk-36YPJ3UN.js";import{$b as m,Rc as f,Wc as M,Xc as c,Yc as q,Zb as t,_b as i,dc as S,ea as g,ic as x,ja as b,ka as h,qc as D,rb as y,rc as _,wc as n,ya as v}from"./chunk-HN5AROX3.js";import{a as p}from"./chunk-C6Q5SG76.js";var R=["form"],L=(()=>{class s{constructor(){this.id=c.required(),this.rev=c.required(),this.done=M(),this.form=q("form"),this.rs=g(O),this.relation=this.rs.read(this.id,this.rev),this.flatData=f({source:()=>this.relation.value(),computation:o=>C(o??{})}),this.fields=f({source:this.flatData,computation:o=>Object.keys(o)}),this._=v(()=>{let o=this.flatData(),e=this.form()?.nativeElement;if(!(!o||!e))for(let[r,a]of Object.entries(o))e[r]&&(e[r].value=a)})}async submit(o){o.preventDefault();let e=o.target;if(!e)return;let r=p({},this.flatData());for(let d of this.fields())if(e[d]){let u=typeof r[d];u==="string"&&(r[d]=e[d].value),u==="number"&&(r[d]=Number(e[d].value)),u==="boolean"&&(r[d]=e[d].checked)}let a=w(r),{result:l,rev:E,user:N}=await this.rs.update(a);l==="conflict"&&(console.log("Conflict detected, please reload the user data"),this.relation.value.set(N)),l==="error"&&(console.log("Error updating the user"),console.error("Error updating the user")),(l==="ok"||l==="noChange")&&(console.log("User updated successfully"),this.relation.reload(),this.done.emit())}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=y({type:s,selectors:[["relation-form"]],viewQuery:function(e,r){e&1&&D(r.form,R,5),e&2&&_()},inputs:{id:[1,"id"],rev:[1,"rev"]},outputs:{done:"done"},decls:37,vars:0,consts:[["form",""],[3,"submit"],["for","name"],["id","name","name","name","required",""],["for","username"],["id","username","name","username","required",""],["for","email"],["id","email","name","email","required","","type","email"],["for","street"],["id","street","name","address.street","required",""],["for","suite"],["id","suite","name","address.suite"],["for","city"],["id","city","name","address.city","required",""],["for","zipcode"],["id","zipcode","name","address.zipcode","required",""],["for","lat"],["id","lat","name","address.geo.lat","required","","min","-90","max","90","type","number","step","0.0001"],["for","lng"],["id","lng","name","address.geo.lng","required","","min","-180","max","180","type","number","step","0.0001"]],template:function(e,r){if(e&1){let a=S();t(0,"form",1,0),x("submit",function(E){return b(a),h(r.submit(E))}),t(2,"label",2),n(3,"Name"),i(),m(4,"input",3),t(5,"label",4),n(6,"Username"),i(),m(7,"input",5),t(8,"label",6),n(9,"Email"),i(),m(10,"input",7),t(11,"fieldset")(12,"legend"),n(13,"Address"),i(),t(14,"label",8),n(15,"Street"),i(),m(16,"input",9),t(17,"label",10),n(18,"Suite"),i(),m(19,"input",11),t(20,"label",12),n(21,"City"),i(),m(22,"input",13),t(23,"label",14),n(24,"Zipcode"),i(),m(25,"input",15),t(26,"fieldset")(27,"legend"),n(28,"Geo"),i(),t(29,"label",16),n(30,"Latitude"),i(),m(31,"input",17),t(32,"label",18),n(33,"Longitude"),i(),m(34,"input",19),i()(),t(35,"button"),n(36,"Submit"),i()()}},styles:['form[_ngcontent-%COMP%], fieldset[_ngcontent-%COMP%]{display:flex;flex-direction:column}input[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]:has(+input[required]):after{display:inline;content:"*";color:orange}input[_ngcontent-%COMP%]:last-child{margin-bottom:0}']})}}return s})();export{L as RelationForm};
