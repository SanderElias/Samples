import{a as x,b as I}from"./chunk-XZCHICF6.js";import{B as A,C as $,D as d,E as m,F as f,I as C,M as b,T as p,V as P,W as v,_ as j,h as y,i as r,j as u,o as s,q as R,s as M,t as D}from"./chunk-VWKE6EEO.js";import{a as h,b as g,h as w}from"./chunk-G5KKTNWD.js";var c,S="sample-cache";function k(){return w(this,null,function*(){if(c)return c;let a=yield x(S);return c=a?new Map([...a]):new Map,c})}function B(a,o){c.set(a,o),I(S,c)}function E(a){return c.has(a)}function L(a){return c.get(a)}var Q=(()=>{let o=class{getAllPagedData(t){return r(this.load(`${t}`)).pipe(b(e=>e.next?this.load(e.next):y))}constructor(){this.baseUrl="https://swapi.dev/api/",this.load=t=>w(this,null,function*(){if(t=F(t),yield k(),!E(t)){let e=yield fetch(t).then(i=>i.json()).catch(i=>{});yield B(t,e)}return L(t)}),this.swapiRoot$=r(this.load(this.baseUrl)).pipe(v(t=>this.swapiRoot=t),p(1)),this.swPeople$=r(this.load(`${this.baseUrl}people/`)).pipe(b(t=>t.next?this.load(t.next):y),s(t=>t.results),d((t,e)=>t.concat(e),[]),s(t=>t.map(e=>g(h({},e),{date:T(),id:e.url}))),p(1)),this.findById=t=>this.swPeople$.pipe(s(e=>e[t]),A(Boolean),C(1)),this.swFilms$=r(this.load(`${this.baseUrl}films/`)).pipe(p(1)),this.findFilmByUrl=t=>this.get(t),this.getRandomPerson=(t=1)=>r(Array.from({length:t})).pipe(f(()=>this.swPeople$.pipe(s(e=>{let i=Math.floor(Math.random()*e.length);return e[i]}),R(e=>D(...e.films.map(i=>this.findFilmByUrl(i))).pipe(m(),s(i=>g(h({},e),{films:i}))))))),this.findIn=(t,e)=>this.getAllRows(t).pipe(s(i=>i.find(n=>(n.name||n.title||"").toLowerCase().includes(e.toLowerCase().trim())))),this.getSetNames=t=>this.getAllRows(t).pipe(s(e=>e.map(i=>i.name||i.title||""))),this.findWithName=t=>this.findIn("people",t),this.loadData().subscribe()}get(t){let e=Object.values(this.swapiRoot).find(i=>t.toLowerCase().includes(i.toLowerCase()));return e?this.getAllPagedData(e).pipe(d((i,n)=>i.concat(n.results),[]),s(i=>i.find(n=>n.url===t))):r(this.load(t))}loadData(){return this.swapiRoot$.pipe(v(t=>this.swapiRoot=t),f(t=>Object.values(t).map(e=>this.getAllPagedData(e))),M(),m(),p(1))}enrich(t){let e=i=>{let n=t[i];return Array.isArray(n)&&n.length>0?r(t[i]).pipe(f(l=>this.get(l)),m(),s(l=>({[i]:l}))):typeof n=="string"?(this.detectSet(n)?this.get(n):u(n)).pipe(s(O=>({[i]:O}))):u(n).pipe(s(l=>({[i]:l})))};return this.swapiRoot$.pipe(f(i=>Object.keys(t).map(e)),M(),d((i,n)=>h(h({},i),n),{}),$(i=>(console.warn(i),u({}))))}getAllRows(t){return this.swapiRoot$.pipe(P(()=>this.getAllPagedData(F(this.swapiRoot[t]))),s(e=>e.results),d((e,i)=>e.concat(i),[]),p(1))}detectSet(t){if(typeof t=="string"){let e=Object.entries(this.swapiRoot).find(([i,n])=>t.includes(n));return e&&e[0]}}},a=o;return(()=>{o.\u0275fac=function(e){return new(e||o)}})(),(()=>{o.\u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})})(),a})();function T(){let a=Math.ceil(Math.random()*1e3)+1e3,o=Math.floor(Math.random()*12),U=Math.ceil(Math.random()*27);return new Date(a,o,U,12,0)}function F(a){return a.split("http:").join("https:")}export{k as a,B as b,E as c,L as d,Q as e};
