import{l as W,m as Z,n as q,q as G}from"./chunk-I27LS666.js";import{$a as C,$b as L,Eb as V,Gb as B,Hb as P,O as F,Va as p,Y as j,b as D,bb as w,cb as c,db as l,f as T,fb as A,gb as I,ha as b,ib as M,ic as U,ja as z,mb as v,nb as g,p as S,q as O,qa as x,ra as y,sb as m,ub as N,vb as R,y as k}from"./chunk-CXFJOMNY.js";import"./chunk-G5KKTNWD.js";var nt=globalThis.__zone_symbol__setTimeout||setTimeout,E=globalThis.__zone_symbol__clearTimeout||clearTimeout;function H(o,e=50){let t=new Map,i=[],r,h=0,d,K=new D(n=>(d=n,Y));return n=>(e=typeof o=="number"?o:e,n.subscribe(s=>{let a=typeof o=="function"?o(s):s;Q(a),a.forEach(X)}),K);function Q(n){t.forEach((s,a)=>{n.includes(a)||(s.sub.unsubscribe(),t.delete(a))})}function X(n,s){let a=t.get(n);if(a===void 0){let et={next:f=>{_.last!==f&&(_.last=f,tt())},error:f=>d.error(f),complete:()=>{}},_={sub:n.subscribe(et),last:void 0,index:s};t.set(n,_);return}a.index=s}function Y(){E(r),t.forEach(n=>n.sub.unsubscribe()),t.clear()}function $(){i.length=t.size,t.forEach(({last:n,index:s})=>i[s]=n),h=Date.now(),r=void 0,d.next(i)}function tt(){r&&E(r),r=nt($,e),Date.now()-h>e&&(r&&E(r),$())}}function it(o,e){if(o&1){let t=M();c(0,"li")(1,"button",1),v("click",function(){let h=x(t).$implicit,d=g(2);return y(d.remove(h.value))}),m(2,"\u{1F5D1}\uFE0F"),l(),m(3),l()}if(o&2){let t=e.$implicit;p(3),R(" ",t==null?null:t.value," - ",t==null?null:t.iteration," ")}}function ot(o,e){if(o&1){let t=M();A(0),c(1,"button",1),v("click",function(){x(t);let r=g();return y(r.add())}),m(2,"Add"),l(),c(3,"span"),m(4),l(),c(5,"ul"),C(6,it,4,2,"li",2),l(),I()}if(o&2){let t=e.ngIf,i=g();p(4),N("Number of items :",t.comp==null?null:t.comp.length,""),p(2),w("ngForOf",t.comp)("ngForTrackBy",i.identify)}}var u=class{constructor(){this.zone=b(L),this.cdr=b(U),this.result=new Map,this.data$=new T(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=e=>this.zone.runOutsideAngular(()=>(this.result.has(e)||this.result.set(e,k(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(S(t=>({value:e,iteration:t})),F(()=>{this.result.delete(e),console.log(`deleted ${e}`)}))),this.result.get(e))),this.completed$=this.zone.runOutsideAngular(()=>this.data$.pipe(H(e=>e.map(this.enrich),250),j(e=>this.cdr.detectChanges()))),this.vm$=O({data:this.data$,comp:this.completed$}).pipe(),this.remove=e=>{let t=this.data$.value.filter(i=>i!==e);this.data$.next(t)}}add(e=Math.floor(Math.random()*150)+50){let t=Math.floor(Math.random()*1e5);if(this.result.has(t))return this.add(e);this.data$.next([...this.data$.value,t]),e>1&&this.add(e-1)}identify(e,t){return t?.value??e}},J=u;(()=>{u.\u0275fac=function(t){return new(t||u)}})(),(()=>{u.\u0275cmp=z({type:u,selectors:[["se-rxjstest"]],standalone:!0,features:[V],decls:4,vars:3,consts:[[4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"]],template:function(t,i){t&1&&(c(0,"h1"),m(1,"Rxjs cleanup test"),l(),C(2,ot,7,3,"ng-container",0),B(3,"async")),t&2&&(p(2),w("ngIf",P(3,1,i.vm$)))},dependencies:[G,W,Z,q],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})})();export{J as RxjstestComponent};
