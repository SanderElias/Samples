import{i as U,j as W,k as Z,n as q}from"./chunk-4XL46QIM.js";import{Hb as N,Jb as V,Kb as B,N as D,X as F,Xa as p,Zb as P,b as $,db as C,f as T,fa as g,fb as y,gb as m,gc as L,ha as j,hb as c,jb as z,kb as R,mb as w,o as O,p as S,pb as M,qa as b,qb as f,ra as x,vb as u,x as k,xb as A,yb as I}from"./chunk-ZWPQDWQV.js";import"./chunk-G5KKTNWD.js";var tt=globalThis.__zone_symbol__setTimeout||setTimeout,v=globalThis.__zone_symbol__clearTimeout||clearTimeout;function G(r,i=50){let n=new Map,t=[],e,a=0,d,H=new $(o=>(d=o,Q));return o=>(i=typeof r=="number"?r:i,o.subscribe(s=>{let l=typeof r=="function"?r(s):s;J(l),l.forEach(K)}),H);function J(o){n.forEach((s,l)=>{o.includes(l)||(s.sub.unsubscribe(),n.delete(l))})}function K(o,s){let l=n.get(o);if(l===void 0){let Y={next:h=>{_.last!==h&&(_.last=h,X())},error:h=>d.error(h),complete:()=>{}},_={sub:o.subscribe(Y),last:void 0,index:s};n.set(o,_);return}l.index=s}function Q(){v(e),n.forEach(o=>o.sub.unsubscribe()),n.clear()}function E(){t.length=n.size,n.forEach(({last:o,index:s})=>t[s]=o),a=Date.now(),e=void 0,d.next(t)}function X(){e&&v(e),e=tt(E,i),Date.now()-a>i&&(e&&v(e),E())}}function et(r,i){if(r&1){let n=w();m(0,"li")(1,"button",1),M("click",function(){let a=b(n).$implicit,d=f(2);return x(d.remove(a.value))}),u(2,"\u{1F5D1}\uFE0F"),c(),u(3),c()}if(r&2){let n=i.$implicit;p(3),I(" ",n==null?null:n.value," - ",n==null?null:n.iteration," ")}}function nt(r,i){if(r&1){let n=w();z(0),m(1,"button",1),M("click",function(){b(n);let e=f();return x(e.add())}),u(2,"Add"),c(),m(3,"span"),u(4),c(),m(5,"ul"),C(6,et,4,2,"li",2),c(),R()}if(r&2){let n=i.ngIf,t=f();p(4),A("Number of items :",n.comp==null?null:n.comp.length,""),p(2),y("ngForOf",n.comp)("ngForTrackBy",t.identify)}}var ut=(()=>{let i=class{constructor(){this.zone=g(P),this.cdr=g(L),this.result=new Map,this.data$=new T(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=t=>this.zone.runOutsideAngular(()=>(this.result.has(t)||this.result.set(t,k(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(O(e=>({value:t,iteration:e})),D(()=>{this.result.delete(t),console.log(`deleted ${t}`)}))),this.result.get(t))),this.completed$=this.zone.runOutsideAngular(()=>this.data$.pipe(G(t=>t.map(this.enrich),250),F(t=>this.cdr.detectChanges()))),this.vm$=S({data:this.data$,comp:this.completed$}).pipe(),this.remove=t=>{let e=this.data$.value.filter(a=>a!==t);this.data$.next(e)}}add(t=Math.floor(Math.random()*150)+50){let e=Math.floor(Math.random()*1e5);if(this.result.has(e))return this.add(t);this.data$.next([...this.data$.value,e]),t>1&&this.add(t-1)}identify(t,e){return e?.value??t}},r=i;return(()=>{i.\u0275fac=function(e){return new(e||i)}})(),(()=>{i.\u0275cmp=j({type:i,selectors:[["se-rxjstest"]],standalone:!0,features:[N],decls:4,vars:3,consts:[[4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"]],template:function(e,a){e&1&&(m(0,"h1"),u(1,"Rxjs cleanup test"),c(),C(2,nt,7,3,"ng-container",0),V(3,"async")),e&2&&(p(2),y("ngIf",B(3,1,a.vm$)))},dependencies:[q,U,W,Z],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})})(),r})();export{ut as RxjstestComponent};
