import{$ as b,I as l,O as w,T as U,U as $,X as A,e as o,n as f,o as h,q as m,x as p}from"./chunk-IWWGYS2Z.js";import{a as c,b as u,h as r}from"./chunk-G5KKTNWD.js";var x=import("./chance-DYYR3VLV.js").then(t=>t).then(({default:t})=>new t);var P=(()=>{let a=class{constructor(){this.flush$=new o,this.updatedUsers$=new o,this.allUsers$=this.flush$.pipe(m(()=>this.updatedUsers$),$([]),U({bufferSize:1,refCount:!1})),this.admins$=this.allUsers$.pipe(h(s=>s.filter(e=>e.isAdmin))),this.users$=this.allUsers$.pipe(h(s=>s.filter(e=>!e.isAdmin))),this.flushCache()}addUsers(s){return r(this,null,function*(){let e=yield f(this.allUsers$),n=e.length,i=yield Promise.all(Array.from({length:s}).map((d,y)=>r(this,null,function*(){return c({id:n+y},yield g())})));this.updatedUsers$.next(e.concat(i))})}saveUser(s){return r(this,null,function*(){let e=yield this.allUsers$.pipe(l(1)).toPromise(),n=e.findIndex(i=>i.id===s.id);if(n>-1)Object.assign(e[n],s);else{let i;for(;!i||e.findIndex(d=>d.id===i)>-1;)i=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);e.unshift(u(c({},s),{id:i}))}this.updatedUsers$.next(e)})}deleteUser(s){return r(this,null,function*(){let e=(yield this.allUsers$.pipe(w()).toPromise()).filter(n=>n.id!==s.id);this.updatedUsers$.next(e)})}flushCache(){return r(this,null,function*(){let s=yield x;yield new Promise(e=>setTimeout(e)),this.flush$.next(),p(0,250).pipe(A(()=>this.addUsers(s.integer({min:100,max:400}))),l(20)).subscribe()})}},t=a;return(()=>{a.\u0275fac=function(e){return new(e||a)}})(),(()=>{a.\u0275prov=b({token:a,factory:a.\u0275fac,providedIn:"root"})})(),t})();function g(){return r(this,null,function*(){let t=yield x;return{userState:t.integer({min:0,max:3}),username:t.name(),isAdmin:t.bool(),isActive:t.bool(),email:t.email()}})}export{P as a};
