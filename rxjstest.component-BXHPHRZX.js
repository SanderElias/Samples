import{i as B,m as L}from"./chunk-KJKGJ6N4.js";import{A as E,Cb as T,Db as V,Gb as F,Hb as O,Ib as m,Jb as c,Ob as x,P as $,Rb as g,Sb as C,Ya as u,Z as j,ac as d,cc as A,d as w,dc as P,ga as S,h as M,kc as I,lb as R,lc as N,na as _,oa as b,r as y,rb as k,rc as z,s as D}from"./chunk-7PPZN5LC.js";import"./chunk-KAT7YFEL.js";function U(n,s=50){let t=new Map,e=[],i,l=0,h,W=new w(o=>(h=o,H));return o=>(s=typeof n=="number"?n:s,o.subscribe(r=>{let a=typeof n=="function"?n(r):r;q(a),a.forEach(G)}),W);function q(o){t.forEach((r,a)=>{o.includes(a)||(r.sub.unsubscribe(),t.delete(a))})}function G(o,r){let a=t.get(o);if(a===void 0){let K={next:p=>{f.last!==p&&(f.last=p,J())},error:p=>h.error(p),complete:()=>{}},f={sub:o.subscribe(K),last:void 0,index:r};t.set(o,f);return}a.index=r}function H(){clearTimeout(i),t.forEach(o=>o.sub.unsubscribe()),t.clear()}function v(){e.length=t.size,t.forEach(({last:o,index:r})=>e[r]=o),l=Date.now(),i=void 0,h.next(e)}function J(){i&&clearTimeout(i),i=setTimeout(v,s),Date.now()-l>s&&(i&&clearTimeout(i),v())}}function Q(n,s){if(n&1){let t=x();m(0,"li")(1,"button",0),g("click",function(){let i=_(t).$implicit,l=C(2);return b(l.remove(i.value))}),d(2,"\u{1F5D1}\uFE0F"),c(),d(3),c()}if(n&2){let t=s.$implicit;u(3),P(" ",t==null?null:t.value," - ",t==null?null:t.iteration," ")}}function X(n,s){if(n&1){let t=x();m(0,"button",0),g("click",function(){_(t);let i=C();return b(i.add())}),d(1,"Add"),c(),m(2,"span"),d(3),c(),m(4,"ul"),F(5,Q,4,2,"li",null,T().identify,!0),c()}if(n&2){let t=s;u(3),A("Number of items :",t.comp.length,""),u(2),O(t.comp)}}var lt=(()=>{class n{constructor(){this.cdr=S(z),this.result=new Map,this.data$=new M(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=t=>(this.result.has(t)||this.result.set(t,E(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(y(e=>({value:t,iteration:e})),$(()=>{this.result.delete(t)}))),this.result.get(t)),this.completed$=this.data$.pipe(U(t=>t.map(this.enrich),250),j(t=>this.cdr.detectChanges())),this.vm$=D({data:this.data$,comp:this.completed$}).pipe(),this.remove=t=>{let e=this.data$.value.filter(i=>i!==t);this.data$.next(e)}}add(t=Math.floor(Math.random()*150)+50){let e=Math.floor(Math.random()*1e5);if(this.result.has(e))return this.add(t);this.data$.next([...this.data$.value,e]),t>1&&this.add(t-1)}identify(t,e){return e?.value??t}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=R({type:n,selectors:[["se-rxjstest"]],decls:4,vars:3,consts:[[3,"click"]],template:function(e,i){if(e&1&&(m(0,"h1"),d(1,"Rxjs cleanup test"),c(),k(2,X,7,1),I(3,"async")),e&2){let l;u(2),V((l=N(3,1,i.vm$))?2:-1,l)}},dependencies:[L,B],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})}}return n})();export{lt as RxjstestComponent};
