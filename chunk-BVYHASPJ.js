import{a as h,b as f,c as T}from"./chunk-BDIKAETI.js";import{O as H,U as E,Y as v,aa as D,da as l,fa as s,l as y}from"./chunk-VNOCNMFG.js";var x=60*1e3,U=new l("HttpGetCachingDefaultExpiry",{providedIn:"root",factory:()=>5*x}),b=new l("HttpCachingRevisionName",{providedIn:"root",factory:()=>{}}),u=new h(()=>!1),p=new h(()=>0),C=new h(()=>{});var R=(t,c)=>(c&&(t.context??=new f,t.context=t.context.set(p,c)),t),j=(t,c)=>(t.context??=new f,t.context=t.context.set(u,!0),R(t,c));var m=(()=>{class t{constructor(){this.#t=new Map,this.#e=0,this.#n=void 0,this.#r=s(U),this.cleanUrl=n=>{try{let o=new URL(n),e=`${o.hostname}${o.pathname}`;return e.endsWith("/")&&e.length>1?e.slice(0,-1):e}catch{let o=new URL(n,"http://localhost"),e=`${o.hostname}${o.pathname}`;return e.endsWith("/")&&e.length>1?e.slice(0,-1):e}},this.#o=()=>{let n=Date.now();for(let[o,e]of this.#t.entries())n>e.expiresOn&&this.#t.delete(o)}}#t;#e;#n;#r;get(n,o){let e=this.cleanUrl(n),r=this.#t.get(e);if(r){if((o?o===r.revision:!0)&&Date.now()<r.expiresOn)return r.expiresOn=Date.now()+r.expiryTime,this.scheduleCacheCleanup(r.expiryTime+50),r.response;this.#t.delete(e)}}set(n,o,e,r){let i=this.cleanUrl(n);r??=this.#r,this.scheduleCacheCleanup(r+50),this.#t.set(i,{expiresOn:Date.now()+r,expiryTime:r,revision:e,response:o})}purge(n){let o=this.cleanUrl(n);this.#t.delete(o)}#o;scheduleCacheCleanup(n){clearTimeout(this.#n),!(this.#e+Math.min(15*x,4*n)<Date.now()&&(this.#e=Date.now(),this.#o(),this.#t.size===0))&&(this.#n=setTimeout(this.#o,n))}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=D({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var d=new Map;function $(t,c){if(!t.context.get(u))return c(t);let n=s(m);if(t.method!=="GET")return(t.method==="POST"||t.method==="PUT"||t.method==="DELETE"||t.method==="PATCH")&&n.purge(t.url),c(t);t.context.has(C)&&n.purge(t.url);let o=s(b),e;o&&t.url.includes(o)&&(e=new URL(t.url,"http://localhost").searchParams.get(o)||void 0);let r=n.get(t.url,e);if(r)return y(r);let i=`${n.cleanUrl(t.url)}|${e??""}`,g=d.get(i);if(g)return g;let w=c(t).pipe(v(a=>{if(!(a instanceof T)||a.status<200||a.status>=300)return;let I=t.context.get(p)||void 0;n.set(t.url,a,e,I)}),H(()=>{d.delete(i)}),E({bufferSize:1,refCount:!0}));return d.set(i,w),w}export{j as a,m as b,$ as c};
