import{i as H}from"./chunk-4KGGYRLN.js";import{A as D,Eb as L,Gb as O,Hb as N,Ib as q,J as w,Jb as r,Kb as a,L as P,Lb as R,Pb as W,Sb as u,T as V,Tb as h,U as A,V as I,X as v,Ya as c,_ as M,cc as o,dc as $,ea as E,f as y,fc as Y,g as k,la as p,lb as T,ma as d,mc as z,nc as G,p as x,q as l,qb as j,r as S,s as C,z as B,zb as F}from"./chunk-ZN5DRON2.js";import{a as f,b as _}from"./chunk-I4MTPUBM.js";var J="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",X=(i=2e3)=>Math.floor(Math.random()*i),Z=()=>J[X(J.length)];var U=()=>Date.now().toString(36).split("").reverse().map(i=>i+Z()).join("");var K=import("./chance-SFBCKYIC.js").then(i=>i).then(({default:i})=>new i);var Q=(()=>{class i{constructor(){this.flush$=new y,this.updatedUsers$=new y,this.allUsers$=this.flush$.pipe(C(()=>this.updatedUsers$),A([]),V({bufferSize:1,refCount:!1})),this.admins$=this.allUsers$.pipe(l(t=>t.filter(e=>e.isAdmin))),this.users$=this.allUsers$.pipe(l(t=>t.filter(e=>!e.isAdmin))),this.flushCache()}async addUsers(t){let e=await x(this.allUsers$),n=e.length,s=await Promise.all(Array.from({length:t}).map(async(m,g)=>_(f({},await et()),{id:U()})));this.updatedUsers$.next(e.concat(s))}async saveUser(t){let e=await x(this.allUsers$),n=e.findIndex(s=>s.id===t.id);if(n>-1)Object.assign(e[n],t);else{let s=U();e.unshift(_(f({},t),{id:s}))}this.updatedUsers$.next(e)}async deleteUser(t){let e=(await x(this.allUsers$)).filter(n=>n.id!==t.id);this.updatedUsers$.next(e)}async flushCache(){let t=await K;await new Promise(e=>setTimeout(e)),this.flush$.next(),B(0,250).pipe(v(()=>this.addUsers(t.integer({min:100,max:400}))),w(20)).subscribe()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();async function et(){let i=await K;return{userState:i.integer({min:0,max:3}),username:i.name(),isAdmin:i.bool(),isActive:i.bool(),email:i.email()}}function it(i,b){if(i&1&&(r(0,"tr")(1,"td"),o(2),a(),r(3,"td"),o(4),a(),r(5,"td"),o(6),a()()),i&2){let t=b.$implicit;c(2),$(t.id),c(2),$(t.username),c(2),$(t.email)}}function nt(i,b){if(i&1){let t=W();r(0,"section"),o(1),R(2,"br"),r(3,"label"),o(4,"Search "),r(5,"input",0),u("input",function(n){p(t);let s=h();return d(s.setProp("search",n))}),a()(),r(6,"div",1)(7,"button",2),u("click",function(n){p(t);let s=h();return d(s.setProp("sort",n))}),o(8,"none"),a(),r(9,"button",3),u("click",function(n){p(t);let s=h();return d(s.setProp("sort",n))}),o(10,"username"),a(),r(11,"button",4),u("click",function(n){p(t);let s=h();return d(s.setProp("sort",n))}),o(12,"email"),a(),r(13,"button",5),u("click",function(n){p(t);let s=h();return d(s.setProp("sort",n))}),o(14,"id"),a()(),r(15,"div",6)(16,"input",7),u("input",function(n){p(t);let s=h();return d(s.setProp("position",n))}),a(),r(17,"table")(18,"tbody"),N(19,it,7,3,"tr",null,O),a()()()()}if(i&2){let t=b;c(),Y(" Available users:",t.users.length," (Loading done:",t.done,"%)"),c(15),F("max",t.users.length/t.state.pageSize),c(3),q(t.page)}}var ft=(()=>{class i{constructor(){this.user=E(Q),this.state$=new k({pageSize:20,position:0,search:"",sort:""}),this.users$=this.state$.pipe(l(t=>t.sort),P(),I(t=>this.user.allUsers$.pipe(l(e=>t===""?e:e.sort((n,s)=>n[t]<s[t]?-1:1))))),this.doneLoadingPer$=D(100).pipe(w(1e3),v(()=>this.user.addUsers(500)),l(t=>Math.ceil(t/1e3*100))),this.curPage$=this.state$.pipe(P(),C(t=>this.users$.pipe(l(e=>this.findFirst(e,t))))),this.vm$=S({users:this.users$,state:this.state$,page:this.curPage$,done:this.doneLoadingPer$})}findFirst(t,{position:e,pageSize:n,search:s}){if(!s)return t.slice(e*n,e*n+n);let m=0,g=[];for(;m<t.length&&g.length<n;)t[m].username.toLowerCase().includes(s.toLowerCase())&&g.push(t[m]),m+=1;return g}setProp(t,e){let n=e.target,s=this.state$.value,m=typeof s[t]=="number";this.state$.next(_(f({},s),{[t]:m?n.valueAsNumber:n.value}))}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=T({type:i,selectors:[["app-big-data"]],decls:4,vars:3,consts:[[3,"input"],["id","buttons"],["value","",3,"click"],["value","username",3,"click"],["value","email",3,"click"],["value","id",3,"click"],["id","scroll"],["type","range",3,"input","max"]],template:function(e,n){if(e&1&&(r(0,"h1"),o(1,"Big data and performance demo"),a(),j(2,nt,21,3,"section"),z(3,"async")),e&2){let s;c(2),L((s=G(3,1,n.vm$))?2:-1,s)}},dependencies:[H],styles:["#scroll[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 1fr}#buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,154px)}#scroll[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{transform:translateY(-100%) rotate(90deg);transform-origin:left bottom;width:20rem;height:40px}"]})}}return i})();export{ft as BigDataComponent};
