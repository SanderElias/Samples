import{a as U}from"./chunk-OZD4UVZE.js";import{g as H}from"./chunk-QOLW2KZO.js";import"./chunk-6QC3C6AT.js";import{A as S,Cb as j,Eb as F,Gb as L,Hb as O,Ib as N,Jb as q,K as w,Kb as r,Lb as a,M as P,Mb as R,Qb as W,Tb as u,Ub as h,V,Va as c,W as A,X as E,Z as v,aa as T,f as y,fa as I,fc as o,g as k,gc as $,hb as M,ic as Y,ka as p,la as d,p as x,q as l,r as D,s as C,tc as z,uc as G,z as B}from"./chunk-CETW4QL6.js";import{a as f,b as _}from"./chunk-DAQOROHW.js";var J=import("./chance-4H2BSSI3.js").then(s=>s).then(({default:s})=>new s);var K=(()=>{class s{constructor(){this.flush$=new y,this.updatedUsers$=new y,this.allUsers$=this.flush$.pipe(C(()=>this.updatedUsers$),A([]),V({bufferSize:1,refCount:!1})),this.admins$=this.allUsers$.pipe(l(e=>e.filter(t=>t.isAdmin))),this.users$=this.allUsers$.pipe(l(e=>e.filter(t=>!t.isAdmin))),this.flushCache()}async addUsers(e){let t=await x(this.allUsers$),i=t.length,n=await Promise.all(Array.from({length:e}).map(async(m,g)=>_(f({},await X()),{id:U()})));this.updatedUsers$.next(t.concat(n))}async saveUser(e){let t=await x(this.allUsers$),i=t.findIndex(n=>n.id===e.id);if(i>-1)Object.assign(t[i],e);else{let n=U();t.unshift(_(f({},e),{id:n}))}this.updatedUsers$.next(t)}async deleteUser(e){let t=(await x(this.allUsers$)).filter(i=>i.id!==e.id);this.updatedUsers$.next(t)}async flushCache(){let e=await J;await new Promise(t=>setTimeout(t)),this.flush$.next(),B(0,250).pipe(v(()=>this.addUsers(e.integer({min:100,max:400}))),w(20)).subscribe()}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=T({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();async function X(){let s=await J;return{userState:s.integer({min:0,max:3}),username:s.name(),isAdmin:s.bool(),isActive:s.bool(),email:s.email()}}function Z(s,b){if(s&1&&(r(0,"tr")(1,"td"),o(2),a(),r(3,"td"),o(4),a(),r(5,"td"),o(6),a()()),s&2){let e=b.$implicit;c(2),$(e.id),c(2),$(e.username),c(2),$(e.email)}}function ee(s,b){if(s&1){let e=W();r(0,"section"),o(1),R(2,"br"),r(3,"label"),o(4,"Search "),r(5,"input",0),u("input",function(i){p(e);let n=h();return d(n.setProp("search",i))}),a()(),r(6,"div",1)(7,"button",2),u("click",function(i){p(e);let n=h();return d(n.setProp("sort",i))}),o(8,"none"),a(),r(9,"button",3),u("click",function(i){p(e);let n=h();return d(n.setProp("sort",i))}),o(10,"username"),a(),r(11,"button",4),u("click",function(i){p(e);let n=h();return d(n.setProp("sort",i))}),o(12,"email"),a(),r(13,"button",5),u("click",function(i){p(e);let n=h();return d(n.setProp("sort",i))}),o(14,"id"),a()(),r(15,"div",6)(16,"input",7),u("input",function(i){p(e);let n=h();return d(n.setProp("position",i))}),a(),r(17,"table")(18,"tbody"),O(19,Z,7,3,"tr",null,L),a()()()()}if(s&2){let e=b;c(),Y(" Available users:",e.users.length," (Loading done:",e.done,"%)"),c(15),q("max",e.users.length/e.state.pageSize),c(3),N(e.page)}}var de=(()=>{class s{constructor(){this.user=I(K),this.state$=new k({pageSize:20,position:0,search:"",sort:""}),this.users$=this.state$.pipe(l(e=>e.sort),P(),E(e=>this.user.allUsers$.pipe(l(t=>e===""?t:t.sort((i,n)=>i[e]<n[e]?-1:1))))),this.doneLoadingPer$=S(100).pipe(w(1e3),v(()=>this.user.addUsers(500)),l(e=>Math.ceil(e/1e3*100))),this.curPage$=this.state$.pipe(P(),C(e=>this.users$.pipe(l(t=>this.findFirst(t,e))))),this.vm$=D({users:this.users$,state:this.state$,page:this.curPage$,done:this.doneLoadingPer$})}findFirst(e,{position:t,pageSize:i,search:n}){if(!n)return e.slice(t*i,t*i+i);let m=0,g=[];for(;m<e.length&&g.length<i;)e[m].username.toLowerCase().includes(n.toLowerCase())&&g.push(e[m]),m+=1;return g}setProp(e,t){let i=t.target,n=this.state$.value,m=typeof n[e]=="number";this.state$.next(_(f({},n),{[e]:m?i.valueAsNumber:i.value}))}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=M({type:s,selectors:[["app-big-data"]],decls:4,vars:3,consts:[[3,"input"],["id","buttons"],["value","",3,"click"],["value","username",3,"click"],["value","email",3,"click"],["value","id",3,"click"],["id","scroll"],["type","range",3,"input","max"]],template:function(t,i){if(t&1&&(r(0,"h1"),o(1,"Big data and performance demo"),a(),j(2,ee,21,3,"section"),z(3,"async")),t&2){let n;c(2),F((n=G(3,1,i.vm$))?2:-1,n)}},dependencies:[H],styles:["#scroll[_ngcontent-%COMP%]{display:grid;grid-template-columns:40px 1fr}#buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,154px)}#scroll[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{transform:translateY(-100%) rotate(90deg);transform-origin:left bottom;width:20rem;height:40px}"],changeDetection:0})}}return s})();export{de as BigDataComponent};
