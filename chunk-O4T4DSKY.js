import{a as s,b as l,c as w}from"./chunk-BOGRN6FE.js";import{Y as d,aa as g,da as u,fa as a,l as m}from"./chunk-VVLACFJL.js";var f=60*1e3,H=new u("HttpGetCachingDefaultExpiry",{providedIn:"root",factory:()=>5*f}),y=new u("HttpCachingRevisionName",{providedIn:"root",factory:()=>{}}),h=new s(()=>!1),p=new s(()=>0),x=new s(()=>{});var E=(t,i)=>(i&&(t.context??=new l,t.context=t.context.set(p,i)),t),v=(t,i)=>(t.context??=new l,t.context=t.context.set(h,!0),E(t,i));var C=(()=>{class t{constructor(){this.#t=new Map,this.#e=0,this.#n=void 0,this.#o=a(H),this.cleanUrl=e=>{let n=new URL(e),o=`${n.hostname}${n.pathname}`;return o.endsWith("/")&&o.length>1?o.slice(0,-1):o},this.#r=()=>{let e=Date.now();for(let[n,o]of this.#t.entries())e>o.expiresOn&&this.#t.delete(n)}}#t;#e;#n;#o;get(e,n){let o=this.cleanUrl(e),r=this.#t.get(o);if(r){if((n?n===r.revision:!0)&&Date.now()<r.expiresOn)return r.expiresOn=Date.now()+r.expiryTime,this.scheduleCacheCleanup(r.expiryTime+50),r.response;this.#t.delete(o)}}set(e,n,o,r){let c=this.cleanUrl(e);r??=this.#o,this.scheduleCacheCleanup(r+50),this.#t.set(c,{expiresOn:Date.now()+r,expiryTime:r,revision:o,response:n})}purge(e){let n=this.cleanUrl(e);this.#t.delete(n)}#r;scheduleCacheCleanup(e){clearTimeout(this.#n),!(this.#e+Math.min(15*f,4*e)<Date.now()&&(this.#e=Date.now(),this.#r(),this.#t.size===0))&&(this.#n=setTimeout(this.#r,e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function D(t,i){if(!t.context.get(h))return i(t);let e=a(C);if(t.method!=="GET")return(t.method==="POST"||t.method==="PUT"||t.method==="DELETE"||t.method==="PATCH")&&e.purge(t.url),i(t);t.context.has(x)&&e.purge(t.url);let n=a(y),o;n&&t.url.includes(n)&&(o=new URL(t.url).searchParams.get(n)||void 0);let r=e.get(t.url,o);return r?m(r):i(t).pipe(d(c=>{!(c instanceof w)||c.status<200||c.status>=300||e.set(t.url,c,o,t.context.get(p))}))}export{v as a,C as b,D as c};
