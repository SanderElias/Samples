import{$ as U,J as o,P as u,U as p,V as w,Y as $,f as r,p as d,q as c,s as m,z as f}from"./chunk-XM75YRED.js";import{a as n,b as h}from"./chunk-KAT7YFEL.js";var b=import("./chance-B42Q2VJL.js").then(s=>s).then(({default:s})=>new s);var g=(()=>{class s{constructor(){this.flush$=new r,this.updatedUsers$=new r,this.allUsers$=this.flush$.pipe(m(()=>this.updatedUsers$),w([]),p({bufferSize:1,refCount:!1})),this.admins$=this.allUsers$.pipe(c(t=>t.filter(e=>e.isAdmin))),this.users$=this.allUsers$.pipe(c(t=>t.filter(e=>!e.isAdmin))),this.flushCache()}async addUsers(t){let e=await d(this.allUsers$),a=e.length,i=await Promise.all(Array.from({length:t}).map(async(l,A)=>n({id:a+A},await x())));this.updatedUsers$.next(e.concat(i))}async saveUser(t){let e=await this.allUsers$.pipe(o(1)).toPromise(),a=e.findIndex(i=>i.id===t.id);if(a>-1)Object.assign(e[a],t);else{let i;for(;!i||e.findIndex(l=>l.id===i)>-1;)i=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);e.unshift(h(n({},t),{id:i}))}this.updatedUsers$.next(e)}async deleteUser(t){let e=(await this.allUsers$.pipe(u()).toPromise()).filter(a=>a.id!==t.id);this.updatedUsers$.next(e)}async flushCache(){let t=await b;await new Promise(e=>setTimeout(e)),this.flush$.next(),f(0,250).pipe($(()=>this.addUsers(t.integer({min:100,max:400}))),o(20)).subscribe()}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=U({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();async function x(){let s=await b;return{userState:s.integer({min:0,max:3}),username:s.name(),isAdmin:s.bool(),isActive:s.bool(),email:s.email()}}export{g as a};
