import{c as S,d as $}from"./chunk-IVQRMR3V.js";import{$ as D,D as b,F as R,G as g,H as f,I as h,K as A,T as p,V as C,X as y,k as r,l as d,q as o,s as M,u as w,v}from"./chunk-KIBRB3UE.js";import{a as l,b as u}from"./chunk-C6Q5SG76.js";var s,I="sample-cache",P=!1;async function F(){try{if(s)return s;var n=await S(I);return s=n?new Map([...n]):new Map,s}catch{return s=new Map,P=!0,s}}function U(n,m){s.set(n,m),!P&&$(I,s)}function O(n){return s.has(n)}function k(n){return s.get(n)}var J=(()=>{class n{getAllPagedData(t){return r(this.load(`${t}`)).pipe()}constructor(){this.baseUrl="https://swapi.info/api/",this.swapiRoot={},this.load=async t=>{if(t=j(t),await F(),!O(t)){let e=await fetch(t).then(i=>i.json()).catch(i=>{});await U(t,e)}return k(t)},this.swapiRoot$=r(this.load(this.baseUrl)).pipe(y(t=>this.swapiRoot=t),p(1)),this.swPeople$=r(this.load(`${this.baseUrl}people/`)).pipe(o(t=>t.map(e=>u(l({},e),{date:x(),id:e.url}))),p(1)),this.findById=t=>this.swPeople$.pipe(o(e=>e[t]),b(Boolean),A(1)),this.swFilms$=r(this.load(`${this.baseUrl}films/`)).pipe(p(1)),this.findFilmByUrl=t=>this.get(t),this.getRandomPerson=(t=1)=>r(Array.from({length:t})).pipe(h(()=>this.swPeople$.pipe(o(e=>{let i=Math.floor(Math.random()*e.length);return e[i]}),M(e=>v(...e.films.map(i=>this.findFilmByUrl(i))).pipe(f(),o(i=>u(l({},e),{films:i}))))))),this.findIn=(t,e)=>this.getAllRows(t).pipe(o(i=>i.find(a=>(a?.name||a?.title||"").toLowerCase().includes(e.toLowerCase().trim())))),this.getSetNames=t=>this.getAllRows(t).pipe(o(e=>e.map(i=>i?.name||i?.title||""))),this.findWithName=t=>this.findIn("people",t),this.loadData().subscribe()}get(t){let e=Object.values(this.swapiRoot).find(i=>t.toLowerCase().includes(i.toLowerCase()));return r(this.load(t))}loadData(){return this.swapiRoot$.pipe(y(t=>this.swapiRoot=t),h(t=>Object.values(t||{}).map(e=>this.getAllPagedData(e))),w(),f(),p(1))}enrich(t){let e=i=>{let a=t[i];return Array.isArray(a)&&a.length>0?r(a).pipe(h(c=>this.get(c)),f(),o(c=>({[i]:c}))):typeof a=="string"?(this.detectSet(a)?this.get(a):d(a)).pipe(o(E=>({[i]:E}))):d(a).pipe(o(c=>({[i]:c})))};return this.swapiRoot$.pipe(h(i=>Object.keys(t).map(e)),w(),g((i,a)=>l(l({},i),a),{}),R(i=>(console.warn(i),d({}))))}getAllRows(t){return this.swapiRoot$.pipe(C(()=>this.getAllPagedData(j(this.swapiRoot[t]))),o(e=>e.results),g((e,i)=>e.concat(i),[]),p(1))}detectSet(t){if(typeof t=="string"){let e=Object.entries(this.swapiRoot).find(([i,a])=>t.includes(a));return e&&e[0]}}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275prov=D({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function x(){let n=Math.ceil(Math.random()*1e3)+1e3,m=Math.floor(Math.random()*12),t=Math.ceil(Math.random()*27);return new Date(n,m,t,12,0)}function j(n){return n.split("http:").join("https:")}export{F as a,U as b,O as c,k as d,J as e};
