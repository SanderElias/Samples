import{a as D}from"./chunk-OZD4UVZE.js";import{$ as v,Lc as S,Nb as E,Ob as x,Pb as I,Ub as a,Vb as d,Ya as h,ea as M,ec as y,ob as C,rc as f,uc as w,va as l}from"./chunk-I3AI3OF7.js";import{a as c,b as u}from"./chunk-DAQOROHW.js";var T=()=>D(),k=n=>n&&typeof n=="object"&&"id"in n&&Array.isArray(n.table),g=n=>{if(k(n))return n;throw new Error("Object is not a DbRecord")};var _=(()=>{class n{#e=l(new Map,{equal:()=>!1});#t=new Map;create(e){let t=e.id??T(),i=g(u(c({},e),{id:t}));this.#e.update(s=>s.set(t,l(i))),this.#t.forEach(s=>{let{table:r,sortFn:o,index:m}=s();if(i.table.includes(r)){let p=o(i);m.set(t,p)}s.set({table:r,sortFn:o,index:m})})}read(e){if(!this.#e().has(e))throw new Error(`Record with id ${e} not found`);return this.#e().get(e)?.asReadonly()}update(e){e=g(e);let i=this.#e().get(e.id);if(!i)throw new Error(`Record with id ${e.id} not found`);let s=c(c({},i()),e);i.set(s),this.#t.forEach(r=>{let{table:o,sortFn:m,index:p}=r();if(s.table.includes(o)){let $=m(s);p.set(e.id,$)}else p.delete(e.id);r.set({table:o,sortFn:m,index:p})})}delete(e){let t=this.#e();if(!t.has(e))throw new Error(`Record with id ${e} not found`);let i=t.get(e)();this.#t.forEach(s=>{let{table:r,index:o}=s();i.table.includes(r)&&o.delete(e),s.set({table:r,sortFn:s().sortFn,index:o})}),t.delete(e)}listTable(e,t="id"){return l(Array.from(this.#e().values()).filter(i=>i().table.includes(e)).sort((i,s)=>i()[t]>s()[t]?1:-1).map(i=>i().id))}findByProp(e,t){let i=this.#e();for(let s of i.values())if(s().table.includes(e)&&t(s()))return s.asReadonly();return l(void 0)}freeTextSearch(e){}createIndex(e,t){let i=`${e}-${t.toString()}`;if(!this.#t.has(i)){let r=new Map;this.#e().forEach(o=>{if(o().table.includes(e)){let m=t(o());r.set(o().id,m)}}),this.#t.set(i,l({table:e,sortFn:t,index:r}))}let s=this.#t.get(i);return S(()=>Array.from(s().index.entries()).sort((r,o)=>r[1]>o[1]?1:-1).map(r=>r[0]))}removeIndex(e,t){this.#t.delete(`${e}-${t.toString()}`)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function A(n,b){if(n&1&&(a(0,"li"),f(1),d()),n&2){let e=b.$implicit,t=y();h(),w("",t.dbs.read(e)().name," (ID: ",e,")")}}function F(n,b){if(n&1&&(a(0,"li"),f(1),d()),n&2){let e=b.$implicit,t=y();h(),w("",t.dbs.read(e)().name," (ID: ",e,")")}}var K=(()=>{class n{constructor(){this.dbs=M(_),this.users=this.dbs.createIndex("users",e=>e.name),this.admins=this.dbs.createIndex("admins",e=>e.name),this.dbs.create({table:["users"],name:"Alice",age:30}),this.dbs.create({table:["users","admins"],name:"Bob",age:25}),this.dbs.create({table:["users"],name:"Charlie",age:35}),this.dbs.create({table:["admins"],name:"Dana",age:28}),setTimeout(()=>{this.dbs.create({table:["users","admins"],name:"Eve",age:22})},2e3),setTimeout(()=>{let e=this.dbs.findByProp("users",t=>t.name==="Bob");e()&&this.dbs.update(u(c({},e()),{name:"Robert",age:26}))},4e3)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=C({type:n,selectors:[["se-in-mem-sample"]],decls:12,vars:0,template:function(t,i){t&1&&(a(0,"h1"),f(1,"In-Memory DB Sample"),d(),a(2,"h2"),f(3,"Users"),d(),a(4,"ul"),x(5,A,2,2,"li",null,E),d(),a(7,"h2"),f(8,"Admins"),d(),a(9,"ul"),x(10,F,2,2,"li",null,E),d()),t&2&&(h(5),I(i.admins()),h(5),I(i.users()))},styles:["[_nghost-%COMP%]{display:block}"]})}}return n})();export{K as InMemSampleComponent};
