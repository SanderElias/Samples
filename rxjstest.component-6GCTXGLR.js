import{i as U,j as W,k as Z,n as q}from"./chunk-GR2PXCGU.js";import{Eb as N,Gb as V,Hb as B,N as k,Vb as P,W as F,Wa as p,ab as C,b as $,cb as y,cc as L,db as m,eb as c,f as D,fa as _,gb as z,ha as j,hb as R,jb as w,mb as M,nb as f,o as T,p as S,pa as b,qa as x,sb as u,ub as A,vb as I,x as O}from"./chunk-X5MK5QQ4.js";import"./chunk-G5KKTNWD.js";var tt=globalThis.__zone_symbol__setTimeout||setTimeout,v=globalThis.__zone_symbol__clearTimeout||clearTimeout;function G(o,i=50){let n=new Map,t=[],e,a=0,d,H=new $(r=>(d=r,Q));return r=>(i=typeof o=="number"?o:i,r.subscribe(s=>{let l=typeof o=="function"?o(s):s;J(l),l.forEach(K)}),H);function J(r){n.forEach((s,l)=>{r.includes(l)||(s.sub.unsubscribe(),n.delete(l))})}function K(r,s){let l=n.get(r);if(l===void 0){let Y={next:h=>{g.last!==h&&(g.last=h,X())},error:h=>d.error(h),complete:()=>{}},g={sub:r.subscribe(Y),last:void 0,index:s};n.set(r,g);return}l.index=s}function Q(){v(e),n.forEach(r=>r.sub.unsubscribe()),n.clear()}function E(){t.length=n.size,n.forEach(({last:r,index:s})=>t[s]=r),a=Date.now(),e=void 0,d.next(t)}function X(){e&&v(e),e=tt(E,i),Date.now()-a>i&&(e&&v(e),E())}}function et(o,i){if(o&1){let n=w();m(0,"li")(1,"button",1),M("click",function(){let a=b(n).$implicit,d=f(2);return x(d.remove(a.value))}),u(2,"\u{1F5D1}\uFE0F"),c(),u(3),c()}if(o&2){let n=i.$implicit;p(3),I(" ",n==null?null:n.value," - ",n==null?null:n.iteration," ")}}function nt(o,i){if(o&1){let n=w();z(0),m(1,"button",1),M("click",function(){b(n);let e=f();return x(e.add())}),u(2,"Add"),c(),m(3,"span"),u(4),c(),m(5,"ul"),C(6,et,4,2,"li",2),c(),R()}if(o&2){let n=i.ngIf,t=f();p(4),A("Number of items :",n.comp==null?null:n.comp.length,""),p(2),y("ngForOf",n.comp)("ngForTrackBy",t.identify)}}var pt=(()=>{let i=class{constructor(){this.zone=_(P),this.cdr=_(L),this.result=new Map,this.data$=new D(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=t=>this.zone.runOutsideAngular(()=>(this.result.has(t)||this.result.set(t,O(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(T(e=>({value:t,iteration:e})),k(()=>{this.result.delete(t),console.log(`deleted ${t}`)}))),this.result.get(t))),this.completed$=this.zone.runOutsideAngular(()=>this.data$.pipe(G(t=>t.map(this.enrich),250),F(t=>this.cdr.detectChanges()))),this.vm$=S({data:this.data$,comp:this.completed$}).pipe(),this.remove=t=>{let e=this.data$.value.filter(a=>a!==t);this.data$.next(e)}}add(t=Math.floor(Math.random()*150)+50){let e=Math.floor(Math.random()*1e5);if(this.result.has(e))return this.add(t);this.data$.next([...this.data$.value,e]),t>1&&this.add(t-1)}identify(t,e){return e?.value??t}},o=i;return(()=>{i.\u0275fac=function(e){return new(e||i)}})(),(()=>{i.\u0275cmp=j({type:i,selectors:[["se-rxjstest"]],standalone:!0,features:[N],decls:4,vars:3,consts:[[4,"ngIf"],[3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"]],template:function(e,a){e&1&&(m(0,"h1"),u(1,"Rxjs cleanup test"),c(),C(2,nt,7,3,"ng-container",0),V(3,"async")),e&2&&(p(2),y("ngIf",B(3,1,a.vm$)))},dependencies:[q,U,W,Z],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})})(),o})();export{pt as RxjstestComponent};
