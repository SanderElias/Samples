import{a as x,b as I}from"./chunk-XZCHICF6.js";import{C as D,D as R,E as h,F as m,G as u,J as A,N as S,U as p,W as j,Y as v,ba as $,h as M,j as s,k as f,p as o,r as b,t as y,u as C}from"./chunk-CXFJOMNY.js";import{a as d,b as w,h as g}from"./chunk-G5KKTNWD.js";var r,F="sample-cache";function O(){return g(this,null,function*(){if(r)return r;let i=yield x(F);return r=i?new Map([...i]):new Map,r})}function k(i,l){r.set(i,l),I(F,r)}function B(i){return r.has(i)}function E(i){return r.get(i)}var V=(()=>{class i{constructor(){this.baseUrl="https://swapi.dev/api/",this.load=e=>g(this,null,function*(){if(e=P(e),yield O(),!B(e)){let t=yield fetch(e).then(n=>n.json()).catch(n=>{});yield k(e,t)}return E(e)}),this.swapiRoot$=s(this.load(this.baseUrl)).pipe(v(e=>this.swapiRoot=e),p(1)),this.swPeople$=s(this.load(`${this.baseUrl}people/`)).pipe(S(e=>e.next?this.load(e.next):M),o(e=>e.results),h((e,t)=>e.concat(t),[]),o(e=>e.map(t=>w(d({},t),{date:L(),id:t.url}))),p(1)),this.findById=e=>this.swPeople$.pipe(o(t=>t[e]),D(Boolean),A(1)),this.swFilms$=s(this.load(`${this.baseUrl}films/`)).pipe(p(1)),this.findFilmByUrl=e=>this.get(e),this.getRandomPerson=(e=1)=>s(Array.from({length:e})).pipe(u(()=>this.swPeople$.pipe(o(t=>{let n=Math.floor(Math.random()*t.length);return t[n]}),b(t=>C(...t.films.map(n=>this.findFilmByUrl(n))).pipe(m(),o(n=>w(d({},t),{films:n}))))))),this.findIn=(e,t)=>this.getAllRows(e).pipe(o(n=>n.find(a=>(a.name||a.title||"").toLowerCase().includes(t.toLowerCase().trim())))),this.findWithName=e=>this.findIn("people",e),this.loadData().subscribe()}getAllPagedData(e){return s(this.load(`${e}`)).pipe(S(t=>t.next?this.load(t.next):M))}get(e){let t=Object.values(this.swapiRoot).find(n=>e.toLowerCase().includes(n.toLowerCase()));return t?this.getAllPagedData(t).pipe(h((n,a)=>n.concat(a.results),[]),o(n=>n.find(a=>a.url===e))):s(this.load(e))}loadData(){return this.swapiRoot$.pipe(v(e=>this.swapiRoot=e),u(e=>Object.values(e).map(t=>this.getAllPagedData(t))),y(),m(),p(1))}enrich(e){let t=n=>{let a=e[n];return Array.isArray(a)&&a.length>0?s(e[n]).pipe(u(c=>this.get(c)),m(),o(c=>({[n]:c}))):typeof a=="string"?(this.detectSet(a)?this.get(a):f(a)).pipe(o(U=>({[n]:U}))):f(a).pipe(o(c=>({[n]:c})))};return this.swapiRoot$.pipe(u(n=>Object.keys(e).map(t)),y(),h((n,a)=>d(d({},n),a),{}),R(n=>(console.warn(n),f({}))))}getAllRows(e){return this.swapiRoot$.pipe(j(()=>this.getAllPagedData(P(this.swapiRoot[e]))),o(t=>t.results),h((t,n)=>t.concat(n),[]),p(1))}detectSet(e){if(typeof e=="string"){let t=Object.entries(this.swapiRoot).find(([n,a])=>e.includes(a));return t&&t[0]}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function L(){let i=Math.ceil(Math.random()*1e3)+1e3,l=Math.floor(Math.random()*12),e=Math.ceil(Math.random()*27);return new Date(i,l,e,12,0)}function P(i){return i.split("http:").join("https:")}export{O as a,k as b,B as c,E as d,V as e};
