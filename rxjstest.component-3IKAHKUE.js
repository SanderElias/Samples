import{i as L,m as U}from"./chunk-IBCCEPDQ.js";import{Ab as O,Bb as m,Cb as c,Hb as x,Kb as g,Lb as C,O as $,Vb as u,Xb as A,Y as S,Yb as P,Za as d,c as w,cc as I,ec as N,fa as j,fc as z,g as M,ha as R,ob as k,pc as B,q as y,r as D,ra as _,sa as b,vb as T,wb as F,z as E,zb as V}from"./chunk-L7DZHDME.js";import"./chunk-KAT7YFEL.js";function W(n,a=50){let t=new Map,e=[],i,l=0,h,q=new w(o=>(h=o,J));return o=>(a=typeof n=="number"?n:a,o.subscribe(r=>{let s=typeof n=="function"?n(r):r;G(s),s.forEach(H)}),q);function G(o){t.forEach((r,s)=>{o.includes(s)||(r.sub.unsubscribe(),t.delete(s))})}function H(o,r){let s=t.get(o);if(s===void 0){let Q={next:p=>{f.last!==p&&(f.last=p,K())},error:p=>h.error(p),complete:()=>{}},f={sub:o.subscribe(Q),last:void 0,index:r};t.set(o,f);return}s.index=r}function J(){clearTimeout(i),t.forEach(o=>o.sub.unsubscribe()),t.clear()}function v(){e.length=t.size,t.forEach(({last:o,index:r})=>e[r]=o),l=Date.now(),i=void 0,h.next(e)}function K(){i&&clearTimeout(i),i=setTimeout(v,a),Date.now()-l>a&&(i&&clearTimeout(i),v())}}function X(n,a){if(n&1){let t=x();m(0,"li")(1,"button",0),g("click",function(){let i=_(t).$implicit,l=C(2);return b(l.remove(i.value))}),u(2,"\u{1F5D1}\uFE0F"),c(),u(3),c()}if(n&2){let t=a.$implicit;d(3),P(" ",t==null?null:t.value," - ",t==null?null:t.iteration," ")}}function Y(n,a){if(n&1){let t=x();m(0,"button",0),g("click",function(){_(t);let i=C();return b(i.add())}),u(1,"Add"),c(),m(2,"span"),u(3),c(),m(4,"ul"),V(5,X,4,2,"li",null,T().identify,!0),c()}if(n&2){let t=a;d(3),A("Number of items :",t.comp.length,""),d(2),O(t.comp)}}var ct=(()=>{class n{constructor(){this.cdr=j(B),this.result=new Map,this.data$=new M(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=t=>(this.result.has(t)||this.result.set(t,E(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(y(e=>({value:t,iteration:e})),$(()=>{this.result.delete(t)}))),this.result.get(t)),this.completed$=this.data$.pipe(W(t=>t.map(this.enrich),250),S(t=>this.cdr.detectChanges())),this.vm$=D({data:this.data$,comp:this.completed$}).pipe(),this.remove=t=>{let e=this.data$.value.filter(i=>i!==t);this.data$.next(e)}}add(t=Math.floor(Math.random()*150)+50){let e=Math.floor(Math.random()*1e5);if(this.result.has(e))return this.add(t);this.data$.next([...this.data$.value,e]),t>1&&this.add(t-1)}identify(t,e){return e?.value??t}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=R({type:n,selectors:[["se-rxjstest"]],standalone:!0,features:[I],decls:4,vars:3,consts:[[3,"click"]],template:function(e,i){if(e&1&&(m(0,"h1"),u(1,"Rxjs cleanup test"),c(),k(2,Y,7,1),N(3,"async")),e&2){let l;d(2),F((l=z(3,1,i.vm$))?2:-1,l)}},dependencies:[U,L],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})}}return n})();export{ct as RxjstestComponent};
