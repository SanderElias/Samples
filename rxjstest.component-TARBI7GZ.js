import{g as z}from"./chunk-NE3XWMKB.js";import"./chunk-QF5K4MHH.js";import{Db as k,Dc as I,Ec as L,Hb as T,Jb as V,Mb as F,Nb as O,P as $,Sb as m,Tb as l,Xa as u,Xc as N,Y as j,Yb as x,bc as g,cc as C,d as v,ea as S,f as w,ja as _,ka as b,kb as R,pc as d,q as M,r as y,rc as A,sc as P,z as D}from"./chunk-JMJSAENN.js";import"./chunk-DAQOROHW.js";function B(n,s=50){let t=new Map,e=[],i,c=0,h,U=new v(o=>(h=o,G));return o=>(s=typeof n=="number"?n:s,o.subscribe(r=>{let a=typeof n=="function"?n(r):r;W(a),a.forEach(q)}),U);function W(o){t.forEach((r,a)=>{o.includes(a)||(r.sub.unsubscribe(),t.delete(a))})}function q(o,r){let a=t.get(o);if(a===void 0){let J={next:p=>{f.last!==p&&(f.last=p,H())},error:p=>h.error(p),complete:()=>{}},f={sub:o.subscribe(J),last:void 0,index:r};t.set(o,f);return}a.index=r}function G(){clearTimeout(i),t.forEach(o=>o.sub.unsubscribe()),t.clear()}function E(){e.length=t.size,t.forEach(({last:o,index:r})=>e[r]=o),c=Date.now(),i=void 0,h.next(e)}function H(){i&&clearTimeout(i),i=setTimeout(E,s),Date.now()-c>s&&(i&&clearTimeout(i),E())}}function K(n,s){if(n&1){let t=x();m(0,"li")(1,"button",0),g("click",function(){let i=_(t).$implicit,c=C(2);return b(c.remove(i.value))}),d(2,"\u{1F5D1}\uFE0F"),l(),d(3),l()}if(n&2){let t=s.$implicit;u(3),P(" ",t==null?null:t.value," - ",t==null?null:t.iteration," ")}}function Q(n,s){if(n&1){let t=x();m(0,"button",0),g("click",function(){_(t);let i=C();return b(i.add())}),d(1,"Add"),l(),m(2,"span"),d(3),l(),m(4,"ul"),F(5,K,4,2,"li",null,k().identify,!0),l()}if(n&2){let t=s;u(3),A("Number of items :",t.comp.length),u(2),O(t.comp)}}var st=(()=>{class n{constructor(){this.cdr=S(N),this.result=new Map,this.data$=new w(Array.from({length:300},()=>Math.floor(Math.random()*1e5)+1)),this.enrich=t=>(this.result.has(t)||this.result.set(t,D(Math.floor(Math.random()*1e4),Math.floor(Math.random()*500)+500).pipe(M(e=>({value:t,iteration:e})),$(()=>{this.result.delete(t)}))),this.result.get(t)),this.completed$=this.data$.pipe(B(t=>t.map(this.enrich),250),j(t=>this.cdr.detectChanges())),this.vm$=y({data:this.data$,comp:this.completed$}).pipe(),this.remove=t=>{let e=this.data$.value.filter(i=>i!==t);this.data$.next(e)}}add(t=Math.floor(Math.random()*150)+50){let e=Math.floor(Math.random()*1e5);if(this.result.has(e))return this.add(t);this.data$.next([...this.data$.value,e]),t>1&&this.add(t-1)}identify(t,e){return e?.value??t}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=R({type:n,selectors:[["se-rxjstest"]],decls:4,vars:3,consts:[[3,"click"]],template:function(e,i){if(e&1&&(m(0,"h1"),d(1,"Rxjs cleanup test"),l(),T(2,Q,7,1),I(3,"async")),e&2){let c;u(2),V((c=L(3,1,i.vm$))?2:-1,c)}},dependencies:[z],styles:["[_nghost-%COMP%]{display:block;max-height:90vh;overflow:auto}button[_ngcontent-%COMP%]{display:inline-block;width:2rem;background-color:inherit;border:none;padding:0;margin:0}ul[_ngcontent-%COMP%]{display:grid;gap:.2rem;list-style:none;padding:0;margin:0;grid-template-columns:repeat(auto-fill,minmax(6rem,1fr))}"],changeDetection:0})}}return n})();export{st as RxjstestComponent};
