import{$ as x,C as R,D as C,E as h,F as m,G as d,J as P,N as v,U as u,W as j,Y as M,i as w,k as l,l as f,q as o,s as S,u as y,v as D}from"./chunk-XM75YRED.js";import{a as p,b as g}from"./chunk-KAT7YFEL.js";function b(i){return new Promise((r,t)=>{i.oncomplete=i.onsuccess=()=>r(i.result),i.onabort=i.onerror=()=>t(i.error)})}function B(i,r){let t=indexedDB.open(i);t.onupgradeneeded=()=>t.result.createObjectStore(r);let e=b(t);return(n,a)=>e.then(c=>a(c.transaction(r,n).objectStore(r)))}var A;function $(){return A||(A=B("keyval-store","keyval")),A}function F(i,r=$()){return r("readonly",t=>b(t.get(i)))}function I(i,r,t=$()){return t("readwrite",e=>(e.put(r,i),b(e.transaction)))}var s,E="sample-cache",O=!1;async function K(){try{if(s)return s;var i=await F(E);return s=i?new Map([...i]):new Map,s}catch{return s=new Map,O=!0,s}}function L(i,r){s.set(i,r),!O&&I(E,s)}function T(i){return s.has(i)}function H(i){return s.get(i)}var q=(()=>{class i{getAllPagedData(t){return l(this.load(`${t}`)).pipe(v(e=>e.next?this.load(e.next):w))}constructor(){this.baseUrl="https://swapi.dev/api/",this.load=async t=>{if(t=k(t),await K(),!T(t)){let e=await fetch(t).then(n=>n.json()).catch(n=>{});await L(t,e)}return H(t)},this.swapiRoot$=l(this.load(this.baseUrl)).pipe(M(t=>this.swapiRoot=t),u(1)),this.swPeople$=l(this.load(`${this.baseUrl}people/`)).pipe(v(t=>t.next?this.load(t.next):w),o(t=>t.results),h((t,e)=>t.concat(e),[]),o(t=>t.map(e=>g(p({},e),{date:W(),id:e.url}))),u(1)),this.findById=t=>this.swPeople$.pipe(o(e=>e[t]),R(Boolean),P(1)),this.swFilms$=l(this.load(`${this.baseUrl}films/`)).pipe(u(1)),this.findFilmByUrl=t=>this.get(t),this.getRandomPerson=(t=1)=>l(Array.from({length:t})).pipe(d(()=>this.swPeople$.pipe(o(e=>{let n=Math.floor(Math.random()*e.length);return e[n]}),S(e=>D(...e.films.map(n=>this.findFilmByUrl(n))).pipe(m(),o(n=>g(p({},e),{films:n}))))))),this.findIn=(t,e)=>this.getAllRows(t).pipe(o(n=>n.find(a=>(a.name||a.title||"").toLowerCase().includes(e.toLowerCase().trim())))),this.getSetNames=t=>this.getAllRows(t).pipe(o(e=>e.map(n=>n.name||n.title||""))),this.findWithName=t=>this.findIn("people",t),this.loadData().subscribe()}get(t){let e=Object.values(this.swapiRoot).find(n=>t.toLowerCase().includes(n.toLowerCase()));return e?this.getAllPagedData(e).pipe(h((n,a)=>n.concat(a.results),[]),o(n=>n.find(a=>a.url===t))):l(this.load(t))}loadData(){return this.swapiRoot$.pipe(M(t=>this.swapiRoot=t),d(t=>Object.values(t).map(e=>this.getAllPagedData(e))),y(),m(),u(1))}enrich(t){let e=n=>{let a=t[n];return Array.isArray(a)&&a.length>0?l(a).pipe(d(c=>this.get(c)),m(),o(c=>({[n]:c}))):typeof a=="string"?(this.detectSet(a)?this.get(a):f(a)).pipe(o(U=>({[n]:U}))):f(a).pipe(o(c=>({[n]:c})))};return this.swapiRoot$.pipe(d(n=>Object.keys(t).map(e)),y(),h((n,a)=>p(p({},n),a),{}),C(n=>(console.warn(n),f({}))))}getAllRows(t){return this.swapiRoot$.pipe(j(()=>this.getAllPagedData(k(this.swapiRoot[t]))),o(e=>e.results),h((e,n)=>e.concat(n),[]),u(1))}detectSet(t){if(typeof t=="string"){let e=Object.entries(this.swapiRoot).find(([n,a])=>t.includes(a));return e&&e[0]}}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=x({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function W(){let i=Math.ceil(Math.random()*1e3)+1e3,r=Math.floor(Math.random()*12),t=Math.ceil(Math.random()*27);return new Date(i,r,t,12,0)}function k(i){return i.split("http:").join("https:")}export{K as a,L as b,T as c,H as d,q as e};
