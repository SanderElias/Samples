import{a as Je,b as We}from"./chunk-TGUHAUM3.js";import{a as V}from"./chunk-ZDGDS7Z3.js";import{b as de,c as z}from"./chunk-X6J3EN2A.js";import{a as $e,b as Ue,c as Fe,d as Be}from"./chunk-46IN262I.js";import{Aa as Y,C as xe,D as H,Db as I,Fb as L,Gb as ee,Gc as m,Hc as Le,I as Ee,Ib as S,Ic as re,Jb as N,Kb as C,Lb as g,M as Pe,Mb as p,Nb as b,Nc as Re,Ob as d,Oc as w,Pb as u,Pc as oe,Qb as te,Rc as ze,U as ce,Ub as E,V as Me,Va as a,Vb as O,W as ke,Wc as j,Yb as P,Z as Se,Zb as M,_b as _,aa as K,c as ve,f as be,fa as f,fc as ne,gc as ie,h as Ce,hb as y,hc as Oe,i as Z,ic as De,ka as h,l as _e,la as v,lc as c,mc as D,nc as A,oa as X,oc as Ae,q as B,qc as Te,r as ye,rc as je,sb as Ne,sc as Ve,ta as x,wc as qe,xc as Ie,z as we}from"./chunk-5REAII6L.js";import{c as he}from"./chunk-DAQOROHW.js";var J=(()=>{class i{constructor(){this.mqtt=import("./mqtt.esm-FGIVSAYR.js"),this.client=this.mqtt.then(e=>e.default.connectAsync("ws://10.0.0.100:1884")),this.baseTopic="zigbee2mqtt",this.messages$=new ve(e=>{let t=(n,r)=>{try{e.next({topic:n,message:JSON.parse(r.toString())})}catch{e.next({topic:n,message:r.toString()})}};return this.client.then(n=>{console.log("start listening for MQTT messages"),n.on("message",t)}),()=>{this.client.then(n=>{n.off("message",t),n.end(),console.log("MQTT client disconnected")})}}).pipe(ce({connector:()=>new be,resetOnComplete:!0})),this.activeTopics=new Map}listenFor(e){let t=this.client;if(typeof e!="string")return console.warn("listenFor expects a string topic, got",e),Z;e=e.startsWith(this.baseTopic)?e:`${this.baseTopic}/${e}`;let n=this.activeTopics;if(n.has(e))return n.get(e);let r=this.messages$.pipe(H(({topic:o})=>Array.isArray(o)?o.includes(e):o===e),B(({message:o})=>o),Ee(100),Pe(V),Se({error(){t.then(o=>o.unsubscribe(e)),n.delete(e),console.log("stopped listening due of error for",e)},complete(){t.then(o=>o.unsubscribe(e)),n.delete(e),console.log("stopped listening for",e)}}),ce({connector:()=>new Ce(1),resetOnComplete:!0,resetOnRefCountZero:()=>we(1005)}));return this.activeTopics.set(e,r),t.then(o=>{o.subscribe([e])}),r}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var T=(()=>{class i{constructor(){this.mqtt=f(J),this.injector=f(X),this.devices=de(this.mqtt.listenFor("bridge/devices"),{initialValue:[]}),this.getDeviceInfo=e=>m(()=>this.#e(e()),{equal:V}),this.getDeviceStatus=e=>z({params:()=>this.#e(e()),stream:({params:t})=>t&&t.friendly_name?this.mqtt.listenFor(`zigbee2mqtt/${t.friendly_name}`):xe,injector:this.injector}),this.getStatus=e=>z({params:()=>Ge(typeof e=="string"?e:e()),stream:({params:t})=>this.mqtt.listenFor(t),injector:this.injector}),this.getMultipleStatuses=e=>z({params:()=>Ge(e()),stream:({params:t})=>!t||t.length===0?_e([]):ye(t.map(n=>this.mqtt.listenFor(n).pipe(ke(null)))).pipe(B(n=>n.map((r,o)=>typeof r!="object"||r===null?{friendly_name:t[o],power:0,energy:0,current:0}:{friendly_name:t[o],power:r.power??0,energy:r.energy??0,current:r.current??0}))),injector:this.injector,equal:V}),this.#t=this.mqtt.listenFor("bridge/logging").pipe(H(e=>e&&typeof e.message=="string"&&["permit_join","zh:ember: [stack status] network","disabling joining new devices"].some(t=>e.message.toLowerCase().includes(t))),B(it),Me(1)),this.joinAllowed=de(this.#t,{initialValue:!1}),this.publish=(e,t)=>new Promise((n,r)=>{typeof t!="string"&&(t=JSON.stringify(t)),this.mqtt.client.then(o=>{o.publish(e,t,void 0,(l,q)=>{l?(console.error("Error publishing to MQTT:",l),r(l)):n(q)})})}),this.#e=e=>this.devices().find(t=>t.ieee_address===e||t.friendly_name===e)}#t;#e;static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function it(i){let s=i.message?.toLowerCase();console.log({lowerLog:s});let e=s?.split("payload '");if(e&&e.length>1)try{let n=JSON.parse(e[1].split("'")[0])?.data?.time??0;return typeof n=="number"&&n>0}catch{return!1}return!!s.includes("open")}var Ge=i=>{if(!(Array.isArray(i)&&i.length===0)&&i!==null&&!(typeof i=="object"&&Object.keys(i).length===0)&&!(typeof i=="string"&&i.trim()==="")&&!(typeof i=="number"&&(isNaN(i)||i===0)))return i};var rt=["dlg"],ot=(i,s)=>s.ieee_address;function st(i,s){i&1&&(d(0,"h5"),c(1,"Er kan"),u(),d(2,"h5"),c(3,"verbonden worden"),u())}function at(i,s){i&1&&(d(0,"h5"),c(1,"klik hier om te pairen"),u())}function lt(i,s){if(i&1&&(d(0,"option",3),c(1),u()),i&2){let e=s.$implicit,t=_();O("value",e.friendly_name)("selected",e.friendly_name===t.selectedRouter()),a(),D(e.friendly_name)}}var Qe=(()=>{class i{constructor(){this.z2m=f(T),this.elm=f(Y).nativeElement,this.selectedPrefixes=w([]),this.selectedRouter=x(""),this.countdown=x(""),this.routerList=m(()=>this.z2m.devices().filter(e=>e.type==="Router").filter(e=>this.selectedPrefixes().some(t=>e.friendly_name?.startsWith(t))).map(e=>({friendly_name:e.friendly_name,ieee_address:e.ieee_address})).sort((e,t)=>e.friendly_name.localeCompare(t.friendly_name))),this.dlg=oe.required("dlg"),this._=j(()=>{let e=this.selectedRouter(),n="pairingRouter"+ct(this.elm),r=localStorage.getItem(n);if(e)e!==r&&(console.log("store",e,"as",n),localStorage.setItem(n,e));else if(r)this.selectedRouter.set(r);else{let o=this.routerList();this.selectedRouter.set(o[0]?.friendly_name||"")}}),this.showDialog=e=>{let t=this.elm.querySelector("div.pbWrapper");this.elm!==e.target&&t!==e.target&&!t?.contains(e.target)||(this.joinAllowed()?this.switchJoin(!1):this.dlg().nativeElement.showModal())},this.joinAllowed=this.z2m.joinAllowed,this.closeDialog=()=>{this.dlg().nativeElement.close()},this.startPairing=async()=>{let e=this.selectedRouter();if(!e){console.error("No router selected for pairing");return}await this.switchJoin(!0),console.log("Started pairing with router:",e),this.dlg().nativeElement.close()},this.switchJoin=async e=>{try{let t=await this.z2m.publish("zigbee2mqtt/bridge/request/permit_join",{value:e,time:e?120:0,device:this.selectedRouter()})}catch(t){console.error("Error switching join:",t)}}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["se-pair-button"]],viewQuery:function(t,n){t&1&&ne(n.dlg,rt,5),t&2&&ie()},hostVars:2,hostBindings:function(t,n){t&1&&P("click",function(o){return n.showDialog(o)}),t&2&&De("background-color",n.joinAllowed()?"var(--color-success)":"var(--color-error)")},inputs:{selectedPrefixes:[1,"selectedPrefixes"]},decls:15,vars:1,consts:[["dlg",""],[1,"pbWrapper",3,"click"],[3,"change"],[3,"value","selected"],[3,"click"]],template:function(t,n){if(t&1){let r=E();d(0,"div",1),M("click",function(l){return h(r),v(n.showDialog(l))}),I(1,st,4,0)(2,at,2,0,"h5"),u(),d(3,"dialog",null,0)(5,"div")(6,"h3"),c(7,"Kies device om mee te pairen"),u(),d(8,"select",2),M("change",function(l){return h(r),v(n.selectedRouter.set(l.target.value))}),S(9,lt,2,3,"option",3,ot),u(),d(11,"button",4),M("click",function(){return h(r),v(n.startPairing())}),c(12,"Start pairen"),u(),d(13,"button",4),M("click",function(){return h(r),v(n.closeDialog())}),c(14,"Afbreken"),u()()()}t&2&&(a(),L(n.joinAllowed()?1:2),a(8),N(n.routerList()))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;cursor:pointer;align-items:center;justify-content:center}dialog[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem}dialog[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > select[_ngcontent-%COMP%]{background:var(--surface-3);border-radius:1rem;padding:.5rem;overflow:auto}"]})}}return i})();function ct(i){let s="";for(;i&&i.tagName!=="BODY";){let e=Array.from(i.parentElement?.children??[])?.indexOf(i)??0;if(s=`${i.tagName}[${e}]${s?"/":""}${s}`.trim(),i.tagName==="HTML")break;i=i.parentElement}return s}var Ze=(()=>{class i{constructor(){this.toggleOnText=w("Aan"),this.toggleOffText=w("Uit"),this.value=w.required(),this.valueChange=Re()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["se-toggle"]],inputs:{toggleOnText:[1,"toggleOnText"],toggleOffText:[1,"toggleOffText"],value:[1,"value"]},outputs:{valueChange:"valueChange"},decls:6,vars:2,consts:[["type","checkbox",3,"change","checked"],[1,"switch"]],template:function(t,n){t&1&&(d(0,"label")(1,"input",0),M("change",function(){return n.valueChange.emit(!n.value())}),u(),d(2,"span",1),te(3,"span"),u(),d(4,"span"),c(5),u()()),t&2&&(a(),O("checked",n.value()),a(4),D(n.value()?n.toggleOnText():n.toggleOffText()))},styles:["[_nghost-%COMP%]{display:block}label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding-block:.5rem;gap:.25rem}input[_ngcontent-%COMP%]{display:none}.switch[_ngcontent-%COMP%]{display:inline-grid;grid-template-columns:0fr 1.25rem 1fr;align-items:center;width:3.5rem;height:1.5rem;padding-inline:.25rem;background-color:#90ee90;border-radius:.75rem;transition:.15s}.switch[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{transition:.15s;display:inline-block;grid-column:2/3;width:1.25rem;height:1.25rem;background-color:green;border-radius:50%}label[_ngcontent-%COMP%]:has(input:not(:checked))   .switch[_ngcontent-%COMP%]{grid-template-columns:1fr 1.25rem 0fr;background-color:#ffa07a}label[_ngcontent-%COMP%]:has(input:not(:checked))   .switch[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{background-color:maroon}"]})}}return i})();var me=$e("mqtt","se-store"),se=i=>Ue(i,me),ue=(i,s)=>Fe(i,s,me);var pe=i=>Be(i,me);function He(i,s,e=f(X)){let t=x(s);return se(i).then(n=>{n!==void 0&&t.set(n)}).catch(()=>{}),Le(async()=>{let n=t(),r=await se(i).catch(()=>{});n!==r&&(n!==void 0?ue(i,n).catch(()=>{}):pe(i).catch(()=>{}))},{injector:e}),t}function Ke(i,s,e){let t=s(),n=re({source:s,computation:(r,o)=>{let l=e(r,o);return l!==o?.value&&l!==void 0?ue(i,l).catch(()=>{}):l===void 0&&pe(i).catch(()=>{}),l}});return se(i).then(r=>{r!==void 0&&n.set(r)}),n}var dt=["dlg"];function mt(i,s){if(i&1&&(d(0,"option",3),c(1),u()),i&2){let e=s.$implicit,t=_();O("value",qe(e))("selected",t.prefix()===e),a(),D(e)}}var Xe=(()=>{class i{constructor(){this.dialogRef=oe.required("dlg"),this.z2m=f(T),this.ieeeAddress=w.required(),this.zigbeePrefixes=G,this.#t=this.z2m.getDeviceInfo(this.ieeeAddress),this.baseName=m(()=>this.#t()?.friendly_name||this.ieeeAddress()),this.name=m(()=>this.baseName().split("/").pop()||""),this.prefix=m(()=>W(this.baseName())),this.show=ze(),this._=j(()=>this.show()?this.openDialog():this.closeDialog()),this.updateName=e=>{e.preventDefault();let t=e.target,n=t.elements.namedItem("name")?.value?.trim()??"",r=t.elements.namedItem("prefix")?.value?.trim()??"",o=`${r}/${n}`.trim();r&&n&&o!==this.baseName()&&this.z2m.publish("zigbee2mqtt/bridge/request/device/rename",{from:this.baseName(),to:o,homeassistant_rename:!0}),this.closeDialog()}}#t;openDialog(){this.dialogRef().nativeElement?.showModal(),this.show.set(!0)}closeDialog(){this.dialogRef().nativeElement?.close(),this.show.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["power-meter-dialog"]],viewQuery:function(t,n){t&1&&ne(n.dialogRef,dt,5),t&2&&ie()},inputs:{ieeeAddress:[1,"ieeeAddress"],show:[1,"show"]},outputs:{show:"showChange"},decls:21,vars:5,consts:[["dlg",""],[3,"submit"],["name","prefix","id","prefix",3,"value"],[3,"value","selected"],["value","",3,"selected"],["type","text","name","name","id","name",3,"value"],["type","submit"],["type","button",3,"click"]],template:function(t,n){if(t&1){let r=E();d(0,"dialog",null,0)(2,"h4"),c(3),u(),d(4,"form",1),M("submit",function(l){return h(r),v(n.updateName(l))}),d(5,"label")(6,"span"),c(7,"indelen bij:"),u(),d(8,"select",2),S(9,mt,2,4,"option",3,ee),d(11,"option",4),c(12,"Geen"),u()()(),d(13,"label")(14,"span"),c(15,"Naam:"),u(),te(16,"input",5),u(),d(17,"button",6),c(18,"Opslaan"),u(),d(19,"button",7),M("click",function(){return h(r),v(n.closeDialog())}),c(20,"Annuleren"),u()()()}t&2&&(a(3),Ae("",n.prefix()," ",n.name()),a(5),O("value",n.prefix()),a(),N(n.zigbeePrefixes),a(2),O("selected",!n.prefix()),a(5),O("value",n.name()))},styles:["[_nghost-%COMP%]{display:block}label[_ngcontent-%COMP%]{margin-block-start:.5rem;display:grid;grid-template-columns:5rem 1fr;align-items:center;gap:.5rem}button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:.5rem}"]})}}return i})();function ut(i,s){if(i&1&&(b(0,"se-gauge",3),c(1),b(2,"br"),c(3),b(4,"br"),c(5),b(6,"br"),c(7),b(8,"br"),c(9),b(10,"br")),i&2){let e,t,n,r=_();C("value",r.currentPower())("maxVal",r.maxUsedPower()),a(),A(" group: ",r.prefix()),a(2),A(" power: ",r.currentPower()," W"),a(2),A(" voltage: ",(e=r.deviceStatus())==null?null:e.voltage," V"),a(2),A(" current: ",(t=r.deviceStatus())==null?null:t.current," A"),a(2),A(" energy: ",(n=r.deviceStatus())==null?null:n.energy," kWh")}}function pt(i,s){if(i&1){let e=E();g(0,"span"),c(1,"Loading..."),p(),b(2,"br"),g(3,"button",0),P("click",function(){h(e);let n=_();return v(n.refresh())}),c(4,"Refresh"),p()}}function ft(i,s){if(i&1){let e=E();g(0,"se-toggle",4),P("valueChange",function(){h(e);let n=_();return v(n.toggle())}),p()}if(i&2){let e=_();C("value",e.isPoweredOn())}}var Ye=(()=>{class i{constructor(){this.dialogOpen=x(!1),this.z2m=f(T),this.ieeeAddress=w.required(),this.#t=this.z2m.getDeviceStatus(this.ieeeAddress),this.deviceLoading=this.#t.isLoading,this.deviceStatus=this.#t.value,this.#e=this.z2m.getDeviceInfo(this.ieeeAddress),this.currentPower=m(()=>this.deviceStatus()?.power||0),this.maxUsedPower=x(0),this.name=m(()=>(this.#e()?.friendly_name||this.ieeeAddress()).split("/").pop()||""),this.prefix=m(()=>W(this.#e()?.friendly_name||this.ieeeAddress())),this.isPoweredOn=m(()=>this.deviceStatus()?.state==="ON"),this.refresh=()=>{this.z2m.publish(`zigbee2mqtt/${this.ieeeAddress()}/get`,{state:""})},this.toggle=()=>{let e=this.isPoweredOn()?"OFF":"ON";this.z2m.publish(`zigbee2mqtt/${this.ieeeAddress()}/set`,{state:e})},this._=Ne(()=>{this.refresh(),this.maxUsedPower=Ke(`zigbee2mqtt/${this.prefix()}-${this.name()}/maxUsedPower`,this.currentPower,(e,t)=>Math.max(e??0,t?.value??0))})}#t;#e;static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["power-meter"]],inputs:{ieeeAddress:[1,"ieeeAddress"]},decls:6,vars:5,consts:[[3,"click"],[3,"value"],[3,"showChange","ieeeAddress","show"],[3,"value","maxVal"],[3,"valueChange","value"]],template:function(t,n){t&1&&(g(0,"h5",0),P("click",function(){return n.dialogOpen.set(!0)}),c(1),p(),I(2,ut,11,7)(3,pt,5,0),I(4,ft,1,1,"se-toggle",1),g(5,"power-meter-dialog",2),Ve("showChange",function(o){return je(n.dialogOpen,o)||(n.dialogOpen=o),o}),p()),t&2&&(a(),A("",n.name()," \u{1F589}"),a(),L(n.deviceLoading()?3:2),a(2),L(n.name().includes("Computer")?-1:4),a(),C("ieeeAddress",n.ieeeAddress()),Te("show",n.dialogOpen))},dependencies:[Ze,Xe,Je],styles:["[_nghost-%COMP%]{display:block}button[_ngcontent-%COMP%]{background-color:var(--surface-4);margin:.5rem}h4[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0;border-radius:50%;aspect-ratio:1 / 1;padding:.5rem;transform:scale(.75)}"]})}}return i})();function W(i){let s=i.match(new RegExp(`^(${G.join("|")})`));return s&&s[0]?s[0]:""}var fe,ae=class extends Error{constructor(s){super(s),this.name="PrettyJSONError"}},ge=(()=>{class i extends HTMLElement{#t;#e;static get observedAttributes(){return["expand","key","truncate-string"]}static{this.DEFAULT_VARIABLES={light:{keyColor:"#cc0000",arrowColor:"#737373",braceColor:"#0030f0",bracketColor:"#0030f0",stringColor:"#009900",numberColor:"#0000ff",nullColor:"#666666",booleanColor:"#d23c91",commaColor:"#666666",ellipsisColor:"#666666",indent:"2rem",fontSize:"1rem",fontFamily:"monospace"},dark:{keyColor:"#f73d3d",arrowColor:"#6c6c6c",braceColor:"#0690bc",bracketColor:"#0690bc",stringColor:"#21c521",numberColor:"#0078b3",nullColor:"#8c8888",booleanColor:"#c737b3",commaColor:"#848181",ellipsisColor:"#c2c2c2",indent:"2rem",fontSize:"1rem",fontFamily:"monospace"}}}#r(){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?fe.DEFAULT_VARIABLES.dark:fe.DEFAULT_VARIABLES.light;if(!this.shadowRoot)return t;let n=getComputedStyle(this.shadowRoot.host);return{keyColor:n.getPropertyValue("--key-color")||t.keyColor,arrowColor:n.getPropertyValue("--arrow-color")||t.arrowColor,braceColor:n.getPropertyValue("--brace-color")||t.braceColor,bracketColor:n.getPropertyValue("--bracket-color")||t.bracketColor,stringColor:n.getPropertyValue("--string-color")||t.stringColor,numberColor:n.getPropertyValue("--number-color")||t.numberColor,nullColor:n.getPropertyValue("--null-color")||t.nullColor,booleanColor:n.getPropertyValue("--boolean-color")||t.booleanColor,commaColor:n.getPropertyValue("--comma-color")||t.commaColor,ellipsisColor:n.getPropertyValue("--ellipsis-color")||t.ellipsisColor,indent:n.getPropertyValue("--indent")||t.indent,fontSize:n.getPropertyValue("--font-size")||t.fontSize,fontFamily:n.getPropertyValue("--font-family")||t.fontFamily}}get#m(){let e=this.#r();return`/* css */
    :host {
      --key-color: ${e.keyColor};
      --arrow-color: ${e.arrowColor};
      --brace-color: ${e.braceColor};
      --bracket-color: ${e.bracketColor};
      --string-color: ${e.stringColor};
      --number-color: ${e.numberColor};
      --null-color: ${e.nullColor};
      --boolean-color: ${e.booleanColor};
      --comma-color: ${e.commaColor};
      --ellipsis-color: ${e.ellipsisColor};
      --indent: ${e.indent};
      --font-size: ${e.fontSize};
      --font-family: ${e.fontFamily};
    }
    button {
      border: none;
      background: transparent;
      cursor: pointer;
      font-family: inherit;
      font-size: var(--font-size);
      vertical-align: text-bottom;
    }
    .container {
      font-family: var(--font-family);
      font-size: var(--font-size);
    }
    .key {
      color: var(--key-color);
      margin-right: 0.5rem;
      padding: 0;
    }
    .key .arrow {
      width: 1rem;
      height: 0.75rem;
      margin-left: -1.25rem;
      padding-right: 0.25rem;
      vertical-align: baseline;
    }
    .arrow .triangle {
      fill: var(--arrow-color);
    }
    .comma {
      color: var(--comma-color);
    }
    .brace {
      color: var(--brace-color);
    }
    .string,
    .url {
      color: var(--string-color);
    }
    .number,
    .bigint {
      color: var(--number-color);
    }
    .null {
      color: var(--null-color);
    }
    .boolean {
      color: var(--boolean-color);
    }

    .ellipsis {
      width: 1rem;
      padding: 0;
      color: var(--ellipsis-color);
    }
    .ellipsis::after {
      content: "\u2026";
    }
    .string .ellipsis::after {
      color: var(--string-color);
    }
    .triangle {
      fill: black;
      stroke: black;
      stroke-width: 0;
    }
    .row {
      padding-left: var(--indent);
    }
    .row .row {
      display: block;
    }
    .row > div,
    .row > span {
      display: inline-block;
    }
  `}constructor(){super(),this.#e=!0,this.attachShadow({mode:"open"})}get#o(){let e=this.getAttribute("expand");if(e===null)return 1;let t=Number.parseInt(e);return isNaN(t)||t<0?0:t}get#n(){let t=this.getAttribute("truncate-string");if(t===null)return 500;let n=Number.parseInt(t);return isNaN(n)||n<0?0:n}#s(){this.#e=!this.#e,this.setAttribute("expand",this.#e?String(this.#o+1):"0"),this.#i()}#u(e,t,n){if(this.#a(e)){let r=this.#c();return r.appendChild(this.#l(e)),r}return this.#g(e)}#a(e){return typeof e!="object"||e===null}#p(){try{return new URL(this.#t),!0}catch{return!1}}#l(e){let t=document.createElement("div"),n=typeof e=="object"?"null":typeof e;if(t.className=`primitive value ${n}`,typeof e=="string")if(this.#p()){let r=document.createElement("a");r.className="url",r.href=this.#t,r.target="_blank",r.textContent=e,t.append('"',r,'"')}else e.length>this.#n?t.appendChild(this.#f(e)):t.textContent=JSON.stringify(e);else t.textContent=JSON.stringify(e);return t}#f(e){let t=document.createElement("div");t.dataset.expandedTimes="1",t.className="truncated string";let n=document.createElement("button");return n.className="ellipsis",n.addEventListener("click",()=>{let r=Number.parseInt(t.dataset.expandedTimes??"1");t.dataset.expandedTimes=String(r+1);let o=e.slice(0,(r+1)*this.#n),l=t.childNodes[1];t.replaceChild(document.createTextNode(o),l)}),t.append('"',e.slice(0,this.#n),n,'"'),t}#c(){let e=document.createElement("div");return e.className="container",e}#g(e){let t=Array.isArray(e),n=this.getAttribute("key"),r=this.#o,o=this.#n,l=this.#c();if(l.classList.add(t?"array":"object"),n){l.classList.add("row");let k=this.#d(n,{withArrow:!0,expanded:this.#e});k.addEventListener("click",this.#s.bind(this)),l.appendChild(k)}let q=document.createElement("span");q.className="open brace",q.textContent=t?"[":"{",l.appendChild(q);let Q=document.createElement("span");if(Q.className="close brace",Q.textContent=t?"]":"}",!this.#e){let k=document.createElement("button");return k.className="ellipsis",l.appendChild(k),k.addEventListener("click",this.#s.bind(this)),l.appendChild(Q),l}return Object.entries(e).forEach(([k,le],nt)=>{if(this.#a(le)){let U=document.createElement("div");if(U.className="row",!t){let F=this.#d(k);U.appendChild(F)}if(U.appendChild(this.#l(le)),l.appendChild(U),!(nt===Object.keys(e).length-1)){let F=document.createElement("span");F.className="comma",F.textContent=",",U.appendChild(F)}return}let $=document.createElement("pretty-json");$.textContent=JSON.stringify(le),$.setAttribute("expand",String(r-1)),$.setAttribute("truncate-string",String(o)),$.setAttribute("key",k),l.appendChild($)}),l.appendChild(Q),l}#h({expanded:e=!1}={}){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","100"),t.setAttribute("height","100"),t.setAttribute("viewBox","0 0 100 100"),t.setAttribute("class","arrow");let n=document.createElementNS("http://www.w3.org/2000/svg","polygon");return n.setAttribute("class","triangle"),n.setAttribute("points","0,0 100,50 0,100"),e&&n.setAttribute("transform","rotate(90 50 50)"),t.appendChild(n),t}#d(e,{withArrow:t=!1,expanded:n=!1}={}){let r=document.createElement(t?"button":"span");if(r.className="key",t){let q=this.#h({expanded:n});r.appendChild(q)}let o=document.createElement("span");o.className="key-name",o.textContent=JSON.stringify(e),r.appendChild(o);let l=document.createElement("span");return l.className="colon",l.textContent=":",r.appendChild(l),r}#i(){if(!this.shadowRoot)throw new ae("Shadow root not available");if(this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(this.#u(this.#t,this.#o,void 0)),this.shadowRoot.querySelector("[data-pretty-json]"))return;let e=document.createElement("style");e.setAttribute("data-pretty-json",""),e.textContent=this.#m,this.shadowRoot.appendChild(e)}attributeChangedCallback(e,t,n){if(e==="expand"){if(n===null)this.#e=!1;else{let r=Number.parseInt(n);this.#e=!isNaN(r)&&r>0}this.#i()}}connectedCallback(){try{this.#t=JSON.parse(this.textContent??"")}catch(e){let t=`Error parsing JSON: ${e instanceof Error?e.message:"Unknown error"}`;throw new ae(t)}this.#i()}update(e){this.#t=e,this.#i()}}return i})();fe=ge;var et=(()=>{class i{#t;#e;#r;constructor(){this.#t=f(Y).nativeElement,this.json=w(),this.#e=m(()=>{let e=this.json();try{JSON.stringify(e)}catch{e={error:"Invalid JSON"}}return e}),this.#r=j({write:()=>{this.#t.update(this.#e())}}),typeof customElements<"u"&&(this.#t.innerText="{}",customElements.get("pretty-json")||customElements.define("pretty-json",ge))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["pretty-json"]],inputs:{json:[1,"json"]},decls:0,vars:0,template:function(t,n){},styles:["[_nghost-%COMP%]{display:block}"]})}}return i})();var gt=(i,s)=>s.name,ht=(i,s)=>s[0],vt=(i,s)=>s.ieee_address;function bt(i,s){if(i&1){let e=E();g(0,"label")(1,"input",11),P("change",function(){let n=h(e).$implicit,r=_();return v(r.checkPf(n))}),p(),c(2),p()}if(i&2){let e=s.$implicit,t=_();a(),C("checked",t.selectedPrefixes().includes(e)),a(),A(" ",e," ")}}function Ct(i,s){if(i&1&&(g(0,"option",4),c(1),p()),i&2){let e=s.$implicit;C("value",e.name),a(),D(e.name)}}function _t(i,s){if(i&1&&(g(0,"option",4),c(1),p()),i&2){let e=s.$implicit;C("value",e[0]),a(),D(e[1])}}function yt(i,s){if(i&1&&(g(0,"div",7),b(1,"pretty-json",12)(2,"pretty-json",12),p()),i&2){let e=_();a(),C("json",e.selectedDevice.value()),a(),C("json",e.selectedDetails())}}function wt(i,s){if(i&1&&b(0,"power-meter",10),i&2){let e=s.$implicit;C("ieeeAddress",e.ieee_address)}}var G=["e&m","s&m","zaak","kamp","test"],Mn=(()=>{class i{constructor(){this.#t=f(J),this.#e=f(T),this.state=x({}),this.cleanState=m(()=>tt(this.state())),this.filter=x(void 0),this.devices=this.#e.devices,this.selectedPrefixes=He("defaultSelectedPrefixes",["e&m","kamp"]),this.zigbeePrefixes=G,this.selected=re(()=>{let e=this.devices(),t=this.filter();if(e?.length&&t){let n=e.find(r=>r.definition?.model===t);if(n)return n.friendly_name||n.ieee_address}}),this.deviceList=m(()=>this.devices().map(t=>({name:t.friendly_name||t.ieee_address})).sort()??[],{equal:V}),this.deviceTypes=m(()=>this.devices()?.reduce((e,t)=>{let n=t.definition?.model||"";return n&&!e.find(r=>r[0]===n)&&e.push([n,t.definition?.description||""]),e},[]).sort()??[],{equal:V}),this.checkPf=e=>{let t=this.selectedPrefixes();t.includes(e)?this.selectedPrefixes.set(t.filter(n=>n!==e)):this.selectedPrefixes.set([...t,e])},this._=j(()=>{this.powerUse()}),this.powerMeters=m(()=>this.devices()?.filter(e=>e.definition?.exposes?.some(t=>t.property==="power"&&t.type==="numeric")).filter(e=>this.selectedPrefixes().some(t=>e.friendly_name?.startsWith(t)||!e.friendly_name?.includes("/"))).sort((e,t)=>e.friendly_name.localeCompare(t.friendly_name))??[]),this.devNames=m(()=>this.powerMeters().map(t=>t.friendly_name||t.ieee_address)),this.allStates=this.#e.getMultipleStatuses(this.devNames),this.powerUse=m(()=>{let e=this.allStates.value()??[],t={};for(let n of e){let r=W(n.friendly_name);t[r]??={power:0,energy:0,current:0},t[r].power+=n.power||0,t[r].energy+=n.energy||0,t[r].current+=n.current||0}return t}),this.powerUsage=m(()=>{let e=this.powerUse();return Object.entries(e).map(([t,n])=>({name:t,value:n.power}))}),this.selectedDetails=m(()=>{let e=this.devices(),t=this.selected();if(t)return e?.find(n=>n.friendly_name===t||n.ieee_address===t)}),this.selectedDevice=z({params:this.selected,stream:e=>{let t=e.params;return t?this.#t.listenFor(t):Z}})}#t;#e;static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["se-mqtt"]],features:[Ie([J,T])],decls:23,vars:3,consts:[["sd",""],[1,"zigbee-prefixes"],[1,"toolbar"],[3,"change"],[3,"value"],["type","checkbox"],[3,"data"],[1,"grid"],[1,"devGrid"],[3,"selectedPrefixes"],[3,"ieeeAddress"],["type","checkbox",3,"change","checked"],[3,"json"]],template:function(t,n){if(t&1){let r=E();g(0,"details")(1,"summary"),c(2,"Settings"),p(),g(3,"div",1),S(4,bt,3,2,"label",null,ee),p(),g(6,"div",2)(7,"select",3),P("change",function(l){return h(r),v(n.selected.set(l.target.value))}),S(8,Ct,2,2,"option",4,gt),p(),g(10,"select",3),P("change",function(l){return h(r),v(n.filter.set(l.target.value))}),S(11,_t,2,2,"option",4,ht),p(),g(13,"label"),b(14,"input",5,0),c(16,"show details"),p()(),b(17,"se-stacked-per",6),I(18,yt,3,2,"div",7),p(),g(19,"div",8),b(20,"se-pair-button",9),S(21,wt,1,1,"power-meter",10,vt),p()}if(t&2){let r=Oe(15);a(4),N(n.zigbeePrefixes),a(4),N(n.deviceList()),a(3),N(n.deviceTypes()),a(6),C("data",n.powerUsage()),a(),L(r.checked?18:-1),a(2),C("selectedPrefixes",n.selectedPrefixes()),a(),N(n.powerMeters())}},dependencies:[et,Ye,Qe,We],styles:["[_nghost-%COMP%]{display:block;padding:1rem;--color-success: #1b3003;--color-error: #351411}div.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(10rem,1fr));gap:10px}div.grid[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{background:var(--surface-3);border-radius:1rem;min-inline-size:10rem;min-block-size:30lh;padding:1rem;overflow:auto}label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0.5rem}div.toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-block-end:1rem}div.toolbar[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{background:var(--surface-3);border-radius:1rem;padding:.5rem;overflow:auto}div.devGrid[_ngcontent-%COMP%]{margin-block-start:1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(15rem,1fr));gap:.5rem}div.devGrid[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{background:var(--surface-3);border-radius:1rem;padding:1rem;overflow:auto}div.zigbee-prefixes[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(6rem,1fr));gap:.5rem;padding-block:.5rem}div.zigbee-prefixes[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{background:var(--surface-3);border-radius:1rem;padding:1rem;overflow:auto}"]})}}return i})(),tt=(i,s="")=>{let n=i,{value:e}=n,t=he(n,["value"]);return Object.keys(t).length===0?e:Object.fromEntries(Object.entries(i).map(([r,o])=>[r,typeof o=="object"?tt(o):o]))};export{Mn as MqttComponent,G as zigbeePrefixes};
